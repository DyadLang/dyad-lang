// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Test Dyad Parser Parse Unicode 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "k‚ÇÅ": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": null,
            "repr": "2",
            "span": {
              "ec": 24,
              "el": 2,
              "sc": 24,
              "sl": 2,
            },
            "type": "ilit",
            "value": 2,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 14,
              "el": 2,
              "sc": 13,
              "sl": 2,
            },
            "value": "k‚ÇÅ",
          },
          "span": {
            "ec": 24,
            "el": 2,
            "sc": 3,
            "sl": 2,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 20,
                  "el": 2,
                  "sc": 17,
                  "sl": 2,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 20,
              "el": 2,
              "sc": 17,
              "sl": 2,
            },
          },
          "variability": "parameter",
        },
        "œâ": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 5,
              "sc": 12,
              "sl": 5,
            },
            "value": "œâ",
          },
          "span": {
            "ec": 18,
            "el": 5,
            "sc": 3,
            "sl": 5,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 18,
                  "el": 5,
                  "sc": 15,
                  "sl": 5,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 18,
              "el": 5,
              "sc": 15,
              "sl": 5,
            },
          },
          "variability": "variable",
        },
        "œâ‚ÇÄ": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": null,
            "repr": "10",
            "span": {
              "ec": 25,
              "el": 3,
              "sc": 24,
              "sl": 3,
            },
            "type": "ilit",
            "value": 10,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 14,
              "el": 3,
              "sc": 13,
              "sl": 3,
            },
            "value": "œâ‚ÇÄ",
          },
          "span": {
            "ec": 25,
            "el": 3,
            "sc": 3,
            "sl": 3,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 20,
                  "el": 3,
                  "sc": 17,
                  "sl": 3,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 20,
              "el": 3,
              "sc": 17,
              "sl": 3,
            },
          },
          "variability": "parameter",
        },
        "üê∞": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": null,
            "repr": "1",
            "span": {
              "ec": 24,
              "el": 4,
              "sc": 24,
              "sl": 4,
            },
            "type": "ilit",
            "value": 1,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 14,
              "el": 4,
              "sc": 13,
              "sl": 4,
            },
            "value": "üê∞",
          },
          "span": {
            "ec": 24,
            "el": 4,
            "sc": 3,
            "sl": 4,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 20,
                  "el": 4,
                  "sc": 17,
                  "sl": 4,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 20,
              "el": 4,
              "sc": 17,
              "sl": 4,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 16,
          "el": 1,
          "sc": 11,
          "sl": 1,
        },
        "value": "ÊûóËä±Ë¨ù‰∫ÜÊò•Á¥Ö",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": true,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "œâ",
                "span": {
                  "ec": 11,
                  "el": 7,
                  "sc": 11,
                  "sl": 7,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "œâ‚ÇÄ",
                "span": {
                  "ec": 16,
                  "el": 7,
                  "sc": 15,
                  "sl": 7,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 16,
            "el": 7,
            "sc": 3,
            "sl": 7,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "func": {
              "elems": [
                {
                  "indices": [],
                  "name": "der",
                  "span": {
                    "ec": 5,
                    "el": 8,
                    "sc": 3,
                    "sl": 8,
                  },
                },
              ],
              "type": "cref",
            },
            "keyword": {},
            "positional": [
              {
                "elems": [
                  {
                    "indices": [],
                    "name": "œâ",
                    "span": {
                      "ec": 7,
                      "el": 8,
                      "sc": 7,
                      "sl": 8,
                    },
                  },
                ],
                "type": "cref",
              },
            ],
            "span": {
              "ec": 8,
              "el": 8,
              "sc": 3,
              "sl": 8,
            },
            "type": "call",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "op": "-",
            "rhs": {
              "elementwise": false,
              "lhs": {
                "elems": [
                  {
                    "indices": [],
                    "name": "k",
                    "span": {
                      "ec": 13,
                      "el": 8,
                      "sc": 13,
                      "sl": 8,
                    },
                  },
                ],
                "type": "cref",
              },
              "op": "*",
              "rhs": {
                "elems": [
                  {
                    "indices": [],
                    "name": "œâ",
                    "span": {
                      "ec": 15,
                      "el": 8,
                      "sc": 15,
                      "sl": 8,
                    },
                  },
                ],
                "type": "cref",
              },
              "type": "bexp",
            },
            "span": {
              "ec": 15,
              "el": 8,
              "sc": 12,
              "sl": 8,
            },
            "type": "uexp",
          },
          "span": {
            "ec": 15,
            "el": 8,
            "sc": 3,
            "sl": 8,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "unicode",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 9,
        "sc": 1,
        "sl": 1,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "unicode",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse Unicode 2`] = `
"component ÊûóËä±Ë¨ù‰∫ÜÊò•Á¥Ö
  parameter k‚ÇÅ::Real = 2
  parameter œâ‚ÇÄ::Real = 10
  parameter üê∞::Real = 1
  variable œâ::Real
relations
  initial œâ = œâ‚ÇÄ
  der(œâ) = -k*œâ
end"
`;

exports[`Test Dyad Parser Parse analyses 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "C": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": "m",
            "repr": "1m",
            "span": {
              "ec": 31,
              "el": 2,
              "sc": 30,
              "sl": 2,
            },
            "type": "rlit",
            "value": 0.001,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 2,
              "sc": 13,
              "sl": 2,
            },
            "value": "C",
          },
          "span": {
            "ec": 31,
            "el": 2,
            "sc": 3,
            "sl": 2,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 2,
                  "sc": 16,
                  "sl": 2,
                },
                "value": "Capacitance",
              },
            ],
            "span": {
              "ec": 26,
              "el": 2,
              "sc": 16,
              "sl": 2,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 22,
          "el": 1,
          "sc": 11,
          "sl": 1,
        },
        "value": "CircuitModel",
      },
      "qualifier": null,
      "relations": [],
      "source": {
        "file": "analyses",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 3,
        "sc": 1,
        "sl": 1,
      },
    },
    {
      "declarations": {
        "data": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "filename": {
                "expr": {
                  "quoted": false,
                  "span": {
                    "ec": 39,
                    "el": 8,
                    "sc": 27,
                    "sl": 8,
                  },
                  "type": "slit",
                  "value": "path/to/csv",
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 39,
                  "el": 8,
                  "sc": 18,
                  "sl": 8,
                },
              },
              "indepvar": {
                "expr": {
                  "quoted": false,
                  "span": {
                    "ec": 53,
                    "el": 8,
                    "sc": 51,
                    "sl": 8,
                  },
                  "type": "slit",
                  "value": "t",
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 53,
                  "el": 8,
                  "sc": 42,
                  "sl": 8,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 16,
                  "el": 8,
                  "sc": 10,
                  "sl": 8,
                },
                "value": "Dataset",
              },
            ],
            "span": {
              "ec": 16,
              "el": 8,
              "sc": 10,
              "sl": 8,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 6,
              "el": 8,
              "sc": 3,
              "sl": 8,
            },
            "value": "data",
          },
          "span": {
            "ec": 54,
            "el": 8,
            "sc": 3,
            "sl": 8,
          },
        },
        "model": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 22,
                  "el": 7,
                  "sc": 11,
                  "sl": 7,
                },
                "value": "CircuitModel",
              },
            ],
            "span": {
              "ec": 22,
              "el": 7,
              "sc": 11,
              "sl": 7,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 7,
              "el": 7,
              "sc": 3,
              "sl": 7,
            },
            "value": "model",
          },
          "span": {
            "ec": 24,
            "el": 7,
            "sc": 3,
            "sl": 7,
          },
        },
      },
      "doc_string": null,
      "extends": {
        "kind": "qtype",
        "mods": {
          "abstol": {
            "expr": {
              "prefix": "m",
              "repr": "0.001m",
              "span": {
                "ec": 62,
                "el": 6,
                "sc": 57,
                "sl": 6,
              },
              "type": "rlit",
              "value": 0.000001,
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 62,
              "el": 6,
              "sc": 50,
              "sl": 6,
            },
          },
          "dtmax": {
            "expr": {
              "prefix": null,
              "repr": "0.1",
              "span": {
                "ec": 87,
                "el": 6,
                "sc": 85,
                "sl": 6,
              },
              "type": "rlit",
              "value": 0.1,
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 87,
              "el": 6,
              "sc": 79,
              "sl": 6,
            },
          },
          "integrator": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 47,
                "el": 6,
                "sc": 40,
                "sl": 6,
              },
              "type": "slit",
              "value": "Rodas4",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 47,
              "el": 6,
              "sc": 29,
              "sl": 6,
            },
          },
          "reltol": {
            "expr": {
              "prefix": "m",
              "repr": "0.01m",
              "span": {
                "ec": 76,
                "el": 6,
                "sc": 72,
                "sl": 6,
              },
              "type": "rlit",
              "value": 0.00001,
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 76,
              "el": 6,
              "sc": 65,
              "sl": 6,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 27,
              "el": 6,
              "sc": 11,
              "sl": 6,
            },
            "value": "TransientAnalysis",
          },
        ],
        "span": {
          "ec": 27,
          "el": 6,
          "sc": 11,
          "sl": 6,
        },
      },
      "kind": "adef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 20,
          "el": 5,
          "sc": 10,
          "sl": 5,
        },
        "value": "MyTransient",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "model",
                "span": {
                  "ec": 7,
                  "el": 10,
                  "sc": 3,
                  "sl": 10,
                },
              },
              {
                "indices": [],
                "name": "resistor",
                "span": {
                  "ec": 16,
                  "el": 10,
                  "sc": 9,
                  "sl": 10,
                },
              },
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 18,
                  "el": 10,
                  "sc": 18,
                  "sl": 10,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "data",
                "span": {
                  "ec": 25,
                  "el": 10,
                  "sc": 22,
                  "sl": 10,
                },
              },
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 27,
                  "el": 10,
                  "sc": 27,
                  "sl": 10,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 27,
            "el": 10,
            "sc": 3,
            "sl": 10,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "model",
                "span": {
                  "ec": 7,
                  "el": 11,
                  "sc": 3,
                  "sl": 11,
                },
              },
              {
                "indices": [],
                "name": "resistor",
                "span": {
                  "ec": 16,
                  "el": 11,
                  "sc": 9,
                  "sl": 11,
                },
              },
              {
                "indices": [],
                "name": "i",
                "span": {
                  "ec": 18,
                  "el": 11,
                  "sc": 18,
                  "sl": 11,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "data",
                "span": {
                  "ec": 25,
                  "el": 11,
                  "sc": 22,
                  "sl": 11,
                },
              },
              {
                "indices": [],
                "name": "i",
                "span": {
                  "ec": 27,
                  "el": 11,
                  "sc": 27,
                  "sl": 11,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 27,
            "el": 11,
            "sc": 3,
            "sl": 11,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "analyses",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 12,
        "sc": 1,
        "sl": 5,
      },
    },
    {
      "declarations": {
        "C": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 17,
              "sc": 13,
              "sl": 17,
            },
            "value": "C",
          },
          "span": {
            "ec": 44,
            "el": 17,
            "sc": 3,
            "sl": 17,
          },
          "type": {
            "kind": "qtype",
            "mods": {
              "max": {
                "expr": {
                  "prefix": "m",
                  "repr": "1m",
                  "span": {
                    "ec": 43,
                    "el": 17,
                    "sc": 42,
                    "sl": 17,
                  },
                  "type": "rlit",
                  "value": 0.001,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 43,
                  "el": 17,
                  "sc": 38,
                  "sl": 17,
                },
              },
              "min": {
                "expr": {
                  "prefix": "n",
                  "repr": "100n",
                  "span": {
                    "ec": 35,
                    "el": 17,
                    "sc": 32,
                    "sl": 17,
                  },
                  "type": "rlit",
                  "value": 1.0000000000000001e-7,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 35,
                  "el": 17,
                  "sc": 28,
                  "sl": 17,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 17,
                  "sc": 16,
                  "sl": 17,
                },
                "value": "Capacitance",
              },
            ],
            "span": {
              "ec": 26,
              "el": 17,
              "sc": 16,
              "sl": 17,
            },
          },
          "variability": "parameter",
        },
        "result": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "C": {
                "expr": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "C",
                      "span": {
                        "ec": 26,
                        "el": 16,
                        "sc": 26,
                        "sl": 16,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 26,
                  "el": 16,
                  "sc": 24,
                  "sl": 16,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 22,
                  "el": 16,
                  "sc": 12,
                  "sl": 16,
                },
                "value": "MyTransient",
              },
            ],
            "span": {
              "ec": 22,
              "el": 16,
              "sc": 12,
              "sl": 16,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 16,
              "sc": 3,
              "sl": 16,
            },
            "value": "result",
          },
          "span": {
            "ec": 27,
            "el": 16,
            "sc": 3,
            "sl": 16,
          },
        },
      },
      "doc_string": null,
      "extends": {
        "kind": "qtype",
        "mods": {
          "maxiters": {
            "expr": {
              "prefix": null,
              "repr": "100",
              "span": {
                "ec": 69,
                "el": 15,
                "sc": 67,
                "sl": 15,
              },
              "type": "ilit",
              "value": 100,
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 69,
              "el": 15,
              "sc": 58,
              "sl": 15,
            },
          },
          "method": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 55,
                "el": 15,
                "sc": 39,
                "sl": 15,
              },
              "type": "slit",
              "value": "single_shooting",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 55,
              "el": 15,
              "sc": 32,
              "sl": 15,
            },
          },
          "optimizer": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 88,
                "el": 15,
                "sc": 82,
                "sl": 15,
              },
              "type": "slit",
              "value": "Ipopt",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 88,
              "el": 15,
              "sc": 72,
              "sl": 15,
            },
          },
          "reduction": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 105,
                "el": 15,
                "sc": 101,
                "sl": 15,
              },
              "type": "slit",
              "value": "sse",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 105,
              "el": 15,
              "sc": 91,
              "sl": 15,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 30,
              "el": 15,
              "sc": 11,
              "sl": 15,
            },
            "value": "OptimizationAnalysis",
          },
        ],
        "span": {
          "ec": 30,
          "el": 15,
          "sc": 11,
          "sl": 15,
        },
      },
      "kind": "adef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 20,
          "el": 14,
          "sc": 10,
          "sl": 14,
        },
        "value": "CalibrateIt",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "cost",
                "span": {
                  "ec": 6,
                  "el": 19,
                  "sc": 3,
                  "sl": 19,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "result",
                "span": {
                  "ec": 15,
                  "el": 19,
                  "sc": 10,
                  "sl": 19,
                },
              },
              {
                "indices": [],
                "name": "cost",
                "span": {
                  "ec": 20,
                  "el": 19,
                  "sc": 17,
                  "sl": 19,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 20,
            "el": 19,
            "sc": 3,
            "sl": 19,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "analyses",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 20,
        "sc": 1,
        "sl": 14,
      },
    },
    {
      "declarations": {
        "C": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 25,
              "sc": 13,
              "sl": 25,
            },
            "value": "C",
          },
          "span": {
            "ec": 44,
            "el": 25,
            "sc": 3,
            "sl": 25,
          },
          "type": {
            "kind": "qtype",
            "mods": {
              "max": {
                "expr": {
                  "prefix": "m",
                  "repr": "1m",
                  "span": {
                    "ec": 43,
                    "el": 25,
                    "sc": 42,
                    "sl": 25,
                  },
                  "type": "rlit",
                  "value": 0.001,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 43,
                  "el": 25,
                  "sc": 38,
                  "sl": 25,
                },
              },
              "min": {
                "expr": {
                  "prefix": "n",
                  "repr": "100n",
                  "span": {
                    "ec": 35,
                    "el": 25,
                    "sc": 32,
                    "sl": 25,
                  },
                  "type": "rlit",
                  "value": 1.0000000000000001e-7,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 35,
                  "el": 25,
                  "sc": 28,
                  "sl": 25,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 25,
                  "sc": 16,
                  "sl": 25,
                },
                "value": "Capacitance",
              },
            ],
            "span": {
              "ec": 26,
              "el": 25,
              "sc": 16,
              "sl": 25,
            },
          },
          "variability": "parameter",
        },
        "result": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "C": {
                "expr": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "C",
                      "span": {
                        "ec": 26,
                        "el": 24,
                        "sc": 26,
                        "sl": 24,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 26,
                  "el": 24,
                  "sc": 24,
                  "sl": 24,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 22,
                  "el": 24,
                  "sc": 12,
                  "sl": 24,
                },
                "value": "MyTransient",
              },
            ],
            "span": {
              "ec": 22,
              "el": 24,
              "sc": 12,
              "sl": 24,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 24,
              "sc": 3,
              "sl": 24,
            },
            "value": "result",
          },
          "span": {
            "ec": 27,
            "el": 24,
            "sc": 3,
            "sl": 24,
          },
        },
      },
      "doc_string": null,
      "extends": {
        "kind": "qtype",
        "mods": {
          "maxiters": {
            "expr": {
              "prefix": null,
              "repr": "100",
              "span": {
                "ec": 71,
                "el": 23,
                "sc": 69,
                "sl": 23,
              },
              "type": "ilit",
              "value": 100,
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 71,
              "el": 23,
              "sc": 60,
              "sl": 23,
            },
          },
          "method": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 57,
                "el": 23,
                "sc": 39,
                "sl": 23,
              },
              "type": "slit",
              "value": "multiple_shooting",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 57,
              "el": 23,
              "sc": 32,
              "sl": 23,
            },
          },
          "optimizer": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 90,
                "el": 23,
                "sc": 84,
                "sl": 23,
              },
              "type": "slit",
              "value": "Ipopt",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 90,
              "el": 23,
              "sc": 74,
              "sl": 23,
            },
          },
          "reduction": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 107,
                "el": 23,
                "sc": 103,
                "sl": 23,
              },
              "type": "slit",
              "value": "sum",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 107,
              "el": 23,
              "sc": 93,
              "sl": 23,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 30,
              "el": 23,
              "sc": 11,
              "sl": 23,
            },
            "value": "OptimizationAnalysis",
          },
        ],
        "span": {
          "ec": 30,
          "el": 23,
          "sc": 11,
          "sl": 23,
        },
      },
      "kind": "adef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 17,
          "el": 22,
          "sc": 10,
          "sl": 22,
        },
        "value": "DesignIt",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "cost",
                "span": {
                  "ec": 6,
                  "el": 27,
                  "sc": 3,
                  "sl": 27,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "result",
                  "span": {
                    "ec": 15,
                    "el": 27,
                    "sc": 10,
                    "sl": 27,
                  },
                },
                {
                  "indices": [],
                  "name": "ampermeter",
                  "span": {
                    "ec": 26,
                    "el": 27,
                    "sc": 17,
                    "sl": 27,
                  },
                },
                {
                  "indices": [],
                  "name": "i",
                  "span": {
                    "ec": 28,
                    "el": 27,
                    "sc": 28,
                    "sl": 27,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "^",
            "rhs": {
              "prefix": null,
              "repr": "2",
              "span": {
                "ec": 30,
                "el": 27,
                "sc": 30,
                "sl": 27,
              },
              "type": "ilit",
              "value": 2,
            },
            "type": "bexp",
          },
          "span": {
            "ec": 30,
            "el": 27,
            "sc": 3,
            "sl": 27,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "analyses",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 28,
        "sc": 1,
        "sl": 22,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "analyses",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse analyses 2`] = `
"component CircuitModel
  parameter C::Capacitance = 1m
end

analysis MyTransient
  extends TransientAnalysis(integrator="Rodas4", abstol=0.001m, reltol=0.01m, dtmax=0.1)
  model = CircuitModel()
  data = Dataset(filename="path/to/csv", indepvar="t")
relations
  model.resistor.v = data.v
  model.resistor.i = data.i
end

analysis CalibrateIt
  extends OptimizationAnalysis(method="single_shooting", maxiters=100, optimizer="Ipopt", reduction="sse")
  result = MyTransient(C=C)
  parameter C::Capacitance(min=100n, max=1m)
relations
  cost = result.cost
end

analysis DesignIt
  extends OptimizationAnalysis(method="multiple_shooting", maxiters=100, optimizer="Ipopt", reduction="sum")
  result = MyTransient(C=C)
  parameter C::Capacitance(min=100n, max=1m)
relations
  cost = result.ampermeter.i^2
end"
`;

exports[`Test Dyad Parser Parse arrays 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "capacitors": {
          "cond": null,
          "constraint": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 20,
                  "el": 4,
                  "sc": 15,
                  "sl": 4,
                },
                "value": "TwoPin",
              },
            ],
            "span": {
              "ec": 20,
              "el": 4,
              "sc": 15,
              "sl": 4,
            },
          },
          "dims": [
            {
              "prefix": null,
              "repr": "4",
              "span": {
                "ec": 22,
                "el": 4,
                "sc": 22,
                "sl": 4,
              },
              "type": "ilit",
              "value": 4,
            },
          ],
          "doc_string": null,
          "indices": [
            {
              "range": {
                "end": {
                  "prefix": null,
                  "repr": "4",
                  "span": {
                    "ec": 55,
                    "el": 4,
                    "sc": 55,
                    "sl": 4,
                  },
                  "type": "ilit",
                  "value": 4,
                },
                "start": {
                  "prefix": null,
                  "repr": "1",
                  "span": {
                    "ec": 53,
                    "el": 4,
                    "sc": 53,
                    "sl": 4,
                  },
                  "type": "ilit",
                  "value": 1,
                },
                "step": null,
                "type": "range",
              },
              "variable": "i",
            },
          ],
          "instance": {
            "kind": "qtype",
            "mods": {
              "C": {
                "expr": {
                  "prefix": "m",
                  "repr": "1m",
                  "span": {
                    "ec": 41,
                    "el": 4,
                    "sc": 40,
                    "sl": 4,
                  },
                  "type": "rlit",
                  "value": 0.001,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 41,
                  "el": 4,
                  "sc": 38,
                  "sl": 4,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 36,
                  "el": 4,
                  "sc": 28,
                  "sl": 4,
                },
                "value": "Capacitor",
              },
            ],
            "span": {
              "ec": 36,
              "el": 4,
              "sc": 28,
              "sl": 4,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 4,
              "sc": 3,
              "sl": 4,
            },
            "value": "capacitors",
          },
          "span": {
            "ec": 56,
            "el": 4,
            "sc": 3,
            "sl": 4,
          },
        },
        "resistors": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [
            {
              "range": {
                "end": {
                  "prefix": null,
                  "repr": "1",
                  "span": {
                    "ec": 47,
                    "el": 3,
                    "sc": 47,
                    "sl": 3,
                  },
                  "type": "ilit",
                  "value": 1,
                },
                "start": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "N",
                      "span": {
                        "ec": 42,
                        "el": 3,
                        "sc": 42,
                        "sl": 3,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "step": {
                  "elementwise": false,
                  "op": "-",
                  "rhs": {
                    "prefix": null,
                    "repr": "1",
                    "span": {
                      "ec": 45,
                      "el": 3,
                      "sc": 45,
                      "sl": 3,
                    },
                    "type": "ilit",
                    "value": 1,
                  },
                  "span": {
                    "ec": 45,
                    "el": 3,
                    "sc": 44,
                    "sl": 3,
                  },
                  "type": "uexp",
                },
                "type": "range",
              },
              "variable": "i",
            },
            {
              "range": {
                "end": {
                  "prefix": null,
                  "repr": "10",
                  "span": {
                    "ec": 62,
                    "el": 3,
                    "sc": 61,
                    "sl": 3,
                  },
                  "type": "ilit",
                  "value": 10,
                },
                "start": {
                  "prefix": null,
                  "repr": "1",
                  "span": {
                    "ec": 59,
                    "el": 3,
                    "sc": 59,
                    "sl": 3,
                  },
                  "type": "ilit",
                  "value": 1,
                },
                "step": null,
                "type": "range",
              },
              "variable": "j",
            },
          ],
          "instance": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "elementwise": false,
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "i",
                        "span": {
                          "ec": 27,
                          "el": 3,
                          "sc": 27,
                          "sl": 3,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "op": "*",
                  "rhs": {
                    "prefix": null,
                    "repr": "10",
                    "span": {
                      "ec": 30,
                      "el": 3,
                      "sc": 29,
                      "sl": 3,
                    },
                    "type": "ilit",
                    "value": 10,
                  },
                  "type": "bexp",
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 30,
                  "el": 3,
                  "sc": 25,
                  "sl": 3,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 3,
                  "sc": 16,
                  "sl": 3,
                },
                "value": "Resistor",
              },
            ],
            "span": {
              "ec": 23,
              "el": 3,
              "sc": 16,
              "sl": 3,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 11,
              "el": 3,
              "sc": 3,
              "sl": 3,
            },
            "value": "resistors",
          },
          "span": {
            "ec": 63,
            "el": 3,
            "sc": 3,
            "sl": 3,
          },
        },
        "x": {
          "cond": null,
          "dims": [
            {
              "prefix": null,
              "repr": "3",
              "span": {
                "ec": 21,
                "el": 5,
                "sc": 21,
                "sl": 5,
              },
              "type": "ilit",
              "value": 3,
            },
          ],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 5,
              "sc": 13,
              "sl": 5,
            },
            "value": "x",
          },
          "span": {
            "ec": 22,
            "el": 5,
            "sc": 3,
            "sl": 5,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 19,
                  "el": 5,
                  "sc": 16,
                  "sl": 5,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 19,
              "el": 5,
              "sc": 16,
              "sl": 5,
            },
          },
          "variability": "parameter",
        },
        "y": {
          "cond": null,
          "dims": [
            {
              "span": {
                "ec": 20,
                "el": 6,
                "sc": 20,
                "sl": 6,
              },
              "type": "ulit",
            },
            {
              "prefix": null,
              "repr": "3",
              "span": {
                "ec": 22,
                "el": 6,
                "sc": 22,
                "sl": 6,
              },
              "type": "ilit",
              "value": 3,
            },
          ],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 6,
              "sc": 12,
              "sl": 6,
            },
            "value": "y",
          },
          "span": {
            "ec": 23,
            "el": 6,
            "sc": 3,
            "sl": 6,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 18,
                  "el": 6,
                  "sc": 15,
                  "sl": 6,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 18,
              "el": 6,
              "sc": 15,
              "sl": 6,
            },
          },
          "variability": "variable",
        },
      },
      "doc_string": {
        "span": {
          "ec": 59,
          "el": 1,
          "sc": 1,
          "sl": 1,
        },
        "value": "This component is to test creating arrays of components.",
      },
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 13,
          "el": 2,
          "sc": 11,
          "sl": 2,
        },
        "value": "Bar",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "indices": [
            {
              "range": {
                "end": {
                  "prefix": null,
                  "repr": "3",
                  "span": {
                    "ec": 14,
                    "el": 8,
                    "sc": 14,
                    "sl": 8,
                  },
                  "type": "ilit",
                  "value": 3,
                },
                "start": {
                  "prefix": null,
                  "repr": "1",
                  "span": {
                    "ec": 12,
                    "el": 8,
                    "sc": 12,
                    "sl": 8,
                  },
                  "type": "ilit",
                  "value": 1,
                },
                "step": null,
                "type": "range",
              },
              "variable": "i",
            },
          ],
          "kind": "forl",
          "metadata": null,
          "relations": [
            {
              "doc_string": null,
              "initial": true,
              "kind": "eq",
              "lhs": {
                "elems": [
                  {
                    "indices": [
                      {
                        "elems": [
                          {
                            "indices": [],
                            "name": "i",
                            "span": {
                              "ec": 15,
                              "el": 9,
                              "sc": 15,
                              "sl": 9,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                    ],
                    "name": "x",
                    "span": {
                      "ec": 16,
                      "el": 9,
                      "sc": 13,
                      "sl": 9,
                    },
                  },
                ],
                "type": "cref",
              },
              "metadata": null,
              "name": null,
              "rhs": {
                "prefix": null,
                "repr": "1.0",
                "span": {
                  "ec": 22,
                  "el": 9,
                  "sc": 20,
                  "sl": 9,
                },
                "type": "ilit",
                "value": 1,
              },
              "span": {
                "ec": 22,
                "el": 9,
                "sc": 5,
                "sl": 9,
              },
              "when": {
                "span": null,
                "type": "blit",
                "value": true,
              },
            },
            {
              "doc_string": null,
              "initial": false,
              "kind": "eq",
              "lhs": {
                "func": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "der",
                      "span": {
                        "ec": 7,
                        "el": 10,
                        "sc": 5,
                        "sl": 10,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "keyword": {},
                "positional": [
                  {
                    "elems": [
                      {
                        "indices": [
                          {
                            "elems": [
                              {
                                "indices": [],
                                "name": "i",
                                "span": {
                                  "ec": 11,
                                  "el": 10,
                                  "sc": 11,
                                  "sl": 10,
                                },
                              },
                            ],
                            "type": "cref",
                          },
                        ],
                        "name": "x",
                        "span": {
                          "ec": 12,
                          "el": 10,
                          "sc": 9,
                          "sl": 10,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                ],
                "span": {
                  "ec": 13,
                  "el": 10,
                  "sc": 5,
                  "sl": 10,
                },
                "type": "call",
              },
              "metadata": null,
              "name": null,
              "rhs": {
                "elementwise": false,
                "lhs": {
                  "prefix": null,
                  "repr": "2.0",
                  "span": {
                    "ec": 19,
                    "el": 10,
                    "sc": 17,
                    "sl": 10,
                  },
                  "type": "ilit",
                  "value": 2,
                },
                "op": "*",
                "rhs": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "i",
                      "span": {
                        "ec": 21,
                        "el": 10,
                        "sc": 21,
                        "sl": 10,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "type": "bexp",
              },
              "span": {
                "ec": 21,
                "el": 10,
                "sc": 5,
                "sl": 10,
              },
              "when": {
                "span": null,
                "type": "blit",
                "value": true,
              },
            },
          ],
          "span": {
            "ec": 5,
            "el": 11,
            "sc": 3,
            "sl": 8,
          },
        },
      ],
      "source": {
        "file": "arrays",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 12,
        "sc": 1,
        "sl": 1,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "arrays",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse arrays 2`] = `
"component Bar
  resistors = [Resistor(R=i*10) for i in N:-1:1, for j in 1:10]
  capacitors::TwoPin[4] = [Capacitor(C=1m) for i in 1:4]
  parameter x::Real[3]
  variable y::Real[:,3]
relations
  for i in 1:3
    initial x[i] = 1.0
    der(x[i]) = 2.0*i
  end
end"
`;

exports[`Test Dyad Parser Parse basic connector 1`] = `
{
  "definitions": [
    {
      "doc_string": null,
      "elements": {
        "i": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 3,
              "sc": 8,
              "sl": 3,
            },
            "value": "i",
          },
          "qualifier": "flow",
          "span": {
            "ec": 19,
            "el": 3,
            "sc": 3,
            "sl": 3,
          },
          "type": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 17,
                  "el": 3,
                  "sc": 11,
                  "sl": 3,
                },
                "value": "Current",
              },
            ],
            "span": {
              "ec": 17,
              "el": 3,
              "sc": 11,
              "sl": 3,
            },
          },
        },
        "v": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "kind": "cvar",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 73,
              "el": 2,
              "sc": 26,
              "sl": 2,
            },
            "value": {
              "Dyad": {
                "size": -5,
                "tags": [
                  "electrical",
                ],
              },
            },
          },
          "name": {
            "span": {
              "ec": 13,
              "el": 2,
              "sc": 13,
              "sl": 2,
            },
            "value": "v",
          },
          "qualifier": "potential",
          "span": {
            "ec": 73,
            "el": 2,
            "sc": 3,
            "sl": 2,
          },
          "type": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 22,
                  "el": 2,
                  "sc": 16,
                  "sl": 2,
                },
                "value": "Voltage",
              },
            ],
            "span": {
              "ec": 22,
              "el": 2,
              "sc": 16,
              "sl": 2,
            },
          },
        },
      },
      "kind": "strcon",
      "metadata": {
        "kind": "meta",
        "span": {
          "ec": 1,
          "el": 9,
          "sc": 1,
          "sl": 4,
        },
        "value": {
          "Dyad": {
            "icon": {
              "neg": "file:./assets/n_pin.svg",
              "pos": "file:./assets/p_pin.svg",
            },
            "pathStyle": "stroke:#a495e6",
          },
        },
      },
      "name": {
        "span": {
          "ec": 3,
          "el": 10,
          "sc": 11,
          "sl": 1,
        },
        "value": "Pin",
      },
      "source": {
        "file": "basicConn",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 10,
        "sc": 11,
        "sl": 1,
      },
    },
    {
      "dims": [],
      "doc_string": null,
      "kind": "sclcon",
      "metadata": null,
      "name": {
        "span": {
          "ec": 19,
          "el": 12,
          "sc": 11,
          "sl": 12,
        },
        "value": "RealInput",
      },
      "qualifier": "input",
      "source": {
        "file": "basicConn",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 19,
        "el": 12,
        "sc": 11,
        "sl": 12,
      },
      "type": {
        "kind": "qtype",
        "mods": null,
        "name": [
          {
            "span": {
              "ec": 32,
              "el": 12,
              "sc": 29,
              "sl": 12,
            },
            "value": "Real",
          },
        ],
        "span": {
          "ec": 32,
          "el": 12,
          "sc": 29,
          "sl": 12,
        },
      },
    },
    {
      "doc_string": null,
      "elements": {
        "m_dot": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 17,
              "sc": 8,
              "sl": 17,
            },
            "value": "m_dot",
          },
          "qualifier": "flow",
          "span": {
            "ec": 26,
            "el": 17,
            "sc": 3,
            "sl": 17,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 17,
                  "sc": 15,
                  "sl": 17,
                },
                "value": "MassFlowRate",
              },
            ],
            "span": {
              "ec": 26,
              "el": 17,
              "sc": 15,
              "sl": 17,
            },
          },
        },
        "medium": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 18,
              "sc": 8,
              "sl": 18,
            },
            "value": "medium",
          },
          "qualifier": "path",
          "span": {
            "ec": 26,
            "el": 18,
            "sc": 3,
            "sl": 18,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 18,
                  "sc": 16,
                  "sl": 18,
                },
                "value": "MediumModel",
              },
            ],
            "span": {
              "ec": 26,
              "el": 18,
              "sc": 16,
              "sl": 18,
            },
          },
        },
        "p": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 25,
              "el": 15,
              "sc": 3,
              "sl": 15,
            },
            "value": "Preserve doc strings",
          },
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 16,
              "sc": 13,
              "sl": 16,
            },
            "value": "p",
          },
          "qualifier": "potential",
          "span": {
            "ec": 23,
            "el": 16,
            "sc": 3,
            "sl": 15,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 16,
                  "sc": 16,
                  "sl": 16,
                },
                "value": "Pressure",
              },
            ],
            "span": {
              "ec": 23,
              "el": 16,
              "sc": 16,
              "sl": 16,
            },
          },
        },
      },
      "kind": "strcon",
      "metadata": null,
      "name": {
        "span": {
          "ec": 3,
          "el": 19,
          "sc": 11,
          "sl": 14,
        },
        "value": "HydraulicPort",
      },
      "source": {
        "file": "basicConn",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 19,
        "sc": 11,
        "sl": 14,
      },
    },
    {
      "doc_string": null,
      "elements": {
        "force": {
          "cond": null,
          "dims": [
            {
              "prefix": null,
              "repr": "3",
              "span": {
                "ec": 21,
                "el": 23,
                "sc": 21,
                "sl": 23,
              },
              "type": "ilit",
              "value": 3,
            },
          ],
          "doc_string": null,
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 23,
              "sc": 8,
              "sl": 23,
            },
            "value": "force",
          },
          "qualifier": "flow",
          "span": {
            "ec": 22,
            "el": 23,
            "sc": 3,
            "sl": 23,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 19,
                  "el": 23,
                  "sc": 15,
                  "sl": 23,
                },
                "value": "Force",
              },
            ],
            "span": {
              "ec": 19,
              "el": 23,
              "sc": 15,
              "sl": 23,
            },
          },
        },
        "x": {
          "cond": null,
          "dims": [
            {
              "prefix": null,
              "repr": "3",
              "span": {
                "ec": 25,
                "el": 22,
                "sc": 25,
                "sl": 22,
              },
              "type": "ilit",
              "value": 3,
            },
          ],
          "doc_string": null,
          "kind": "cvar",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 22,
              "sc": 13,
              "sl": 22,
            },
            "value": "x",
          },
          "qualifier": "potential",
          "span": {
            "ec": 26,
            "el": 22,
            "sc": 3,
            "sl": 22,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 22,
                  "sc": 16,
                  "sl": 22,
                },
                "value": "Position",
              },
            ],
            "span": {
              "ec": 23,
              "el": 22,
              "sc": 16,
              "sl": 22,
            },
          },
        },
      },
      "kind": "strcon",
      "metadata": null,
      "name": {
        "span": {
          "ec": 3,
          "el": 24,
          "sc": 11,
          "sl": 21,
        },
        "value": "Flange3D",
      },
      "source": {
        "file": "basicConn",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 24,
        "sc": 11,
        "sl": 21,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "basicConn",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse basic connector 2`] = `
"connector Pin
  potential v::Voltage()
  flow i::Current()
end

connector RealInput = input Real

connector HydraulicPort
  potential p::Pressure
  flow m_dot::MassFlowRate
  path medium::MediumModel
end

connector Flange3D
  potential x::Position[3]
  flow force::Force[3]
end"
`;

exports[`Test Dyad Parser Parse conditional 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "T": {
          "cond": {
            "elems": [
              {
                "indices": [],
                "name": "use_thermal",
                "span": {
                  "ec": 40,
                  "el": 4,
                  "sc": 30,
                  "sl": 4,
                },
              },
            ],
            "type": "cref",
          },
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 4,
              "sc": 12,
              "sl": 4,
            },
            "value": "T",
          },
          "span": {
            "ec": 40,
            "el": 4,
            "sc": 3,
            "sl": 4,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 4,
                  "sc": 15,
                  "sl": 4,
                },
                "value": "Temperature",
              },
            ],
            "span": {
              "ec": 25,
              "el": 4,
              "sc": 15,
              "sl": 4,
            },
          },
          "variability": "variable",
        },
        "node": {
          "cond": {
            "elems": [
              {
                "indices": [],
                "name": "use_thermal",
                "span": {
                  "ec": 30,
                  "el": 2,
                  "sc": 20,
                  "sl": 2,
                },
              },
            ],
            "type": "cref",
          },
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 13,
                  "el": 2,
                  "sc": 10,
                  "sl": 2,
                },
                "value": "Node",
              },
            ],
            "span": {
              "ec": 13,
              "el": 2,
              "sc": 10,
              "sl": 2,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 6,
              "el": 2,
              "sc": 3,
              "sl": 2,
            },
            "value": "node",
          },
          "span": {
            "ec": 30,
            "el": 2,
            "sc": 3,
            "sl": 2,
          },
        },
        "use_thermal": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 23,
              "el": 3,
              "sc": 13,
              "sl": 3,
            },
            "value": "use_thermal",
          },
          "span": {
            "ec": 32,
            "el": 3,
            "sc": 3,
            "sl": 3,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 32,
                  "el": 3,
                  "sc": 26,
                  "sl": 3,
                },
                "value": "Boolean",
              },
            ],
            "span": {
              "ec": 32,
              "el": 3,
              "sc": 26,
              "sl": 3,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 13,
          "el": 1,
          "sc": 11,
          "sl": 1,
        },
        "value": "Foo",
      },
      "qualifier": null,
      "relations": [],
      "source": {
        "file": "conditional",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 5,
        "sc": 1,
        "sl": 1,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "conditional",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse conditional 2`] = `
"component Foo
  node = Node() if use_thermal
  parameter use_thermal::Boolean
  variable T::Temperature if use_thermal
end"
`;

exports[`Test Dyad Parser Parse expressions 1`] = `
{
  "definitions": [
    {
      "base": {
        "kind": "qtype",
        "mods": {
          "b": {
            "expr": {
              "contents": [
                {
                  "prefix": "k",
                  "repr": "5k",
                  "span": {
                    "ec": 36,
                    "el": 1,
                    "sc": 35,
                    "sl": 1,
                  },
                  "type": "ilit",
                  "value": 5000,
                },
                {
                  "elementwise": false,
                  "lhs": {
                    "prefix": null,
                    "repr": "5",
                    "span": {
                      "ec": 39,
                      "el": 1,
                      "sc": 39,
                      "sl": 1,
                    },
                    "type": "ilit",
                    "value": 5,
                  },
                  "op": "%",
                  "rhs": {
                    "prefix": null,
                    "repr": "2",
                    "span": {
                      "ec": 41,
                      "el": 1,
                      "sc": 41,
                      "sl": 1,
                    },
                    "type": "ilit",
                    "value": 2,
                  },
                  "type": "bexp",
                },
              ],
              "span": {
                "ec": 42,
                "el": 1,
                "sc": 34,
                "sl": 1,
              },
              "type": "arr",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 42,
              "el": 1,
              "sc": 32,
              "sl": 1,
            },
          },
          "c": {
            "expr": {
              "expr": {
                "elementwise": false,
                "lhs": {
                  "span": {
                    "ec": 51,
                    "el": 1,
                    "sc": 48,
                    "sl": 1,
                  },
                  "type": "blit",
                  "value": true,
                },
                "op": "and",
                "rhs": {
                  "span": {
                    "ec": 61,
                    "el": 1,
                    "sc": 57,
                    "sl": 1,
                  },
                  "type": "blit",
                  "value": false,
                },
                "type": "bexp",
              },
              "span": {
                "ec": 62,
                "el": 1,
                "sc": 47,
                "sl": 1,
              },
              "type": "paren",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 62,
              "el": 1,
              "sc": 45,
              "sl": 1,
            },
          },
          "d": {
            "expr": {
              "func": {
                "elems": [
                  {
                    "indices": [],
                    "name": "f",
                    "span": {
                      "ec": 67,
                      "el": 1,
                      "sc": 67,
                      "sl": 1,
                    },
                  },
                ],
                "type": "cref",
              },
              "keyword": {
                "x": {
                  "prefix": null,
                  "repr": "5e+2",
                  "span": {
                    "ec": 80,
                    "el": 1,
                    "sc": 77,
                    "sl": 1,
                  },
                  "type": "ilit",
                  "value": 500,
                },
              },
              "positional": [
                {
                  "prefix": null,
                  "repr": "5",
                  "span": {
                    "ec": 69,
                    "el": 1,
                    "sc": 69,
                    "sl": 1,
                  },
                  "type": "ilit",
                  "value": 5,
                },
                {
                  "prefix": null,
                  "repr": "6",
                  "span": {
                    "ec": 72,
                    "el": 1,
                    "sc": 72,
                    "sl": 1,
                  },
                  "type": "ilit",
                  "value": 6,
                },
              ],
              "span": {
                "ec": 81,
                "el": 1,
                "sc": 67,
                "sl": 1,
              },
              "type": "call",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 81,
              "el": 1,
              "sc": 65,
              "sl": 1,
            },
          },
          "e": {
            "expr": {
              "elems": [
                {
                  "indices": [],
                  "name": "d",
                  "span": {
                    "ec": 86,
                    "el": 1,
                    "sc": 86,
                    "sl": 1,
                  },
                },
                {
                  "indices": [],
                  "name": "a",
                  "span": {
                    "ec": 88,
                    "el": 1,
                    "sc": 88,
                    "sl": 1,
                  },
                },
              ],
              "type": "cref",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 88,
              "el": 1,
              "sc": 84,
              "sl": 1,
            },
          },
          "f": {
            "expr": {
              "elementwise": false,
              "lhs": {
                "prefix": "k",
                "repr": "1k",
                "span": {
                  "ec": 94,
                  "el": 1,
                  "sc": 93,
                  "sl": 1,
                },
                "type": "ilit",
                "value": 1000,
              },
              "op": "+",
              "rhs": {
                "prefix": "m",
                "repr": "1m",
                "span": {
                  "ec": 97,
                  "el": 1,
                  "sc": 96,
                  "sl": 1,
                },
                "type": "rlit",
                "value": 0.001,
              },
              "type": "bexp",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 97,
              "el": 1,
              "sc": 91,
              "sl": 1,
            },
          },
          "g": {
            "expr": {
              "func": {
                "elems": [
                  {
                    "indices": [],
                    "name": "Resistor",
                    "span": {
                      "ec": 109,
                      "el": 1,
                      "sc": 102,
                      "sl": 1,
                    },
                  },
                ],
                "type": "cref",
              },
              "keyword": {
                "R": {
                  "prefix": null,
                  "repr": "10.0",
                  "span": {
                    "ec": 116,
                    "el": 1,
                    "sc": 113,
                    "sl": 1,
                  },
                  "type": "ilit",
                  "value": 10,
                },
              },
              "positional": [],
              "span": {
                "ec": 117,
                "el": 1,
                "sc": 102,
                "sl": 1,
              },
              "type": "call",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 117,
              "el": 1,
              "sc": 100,
              "sl": 1,
            },
          },
          "units": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 29,
                "el": 1,
                "sc": 27,
                "sl": 1,
              },
              "type": "slit",
              "value": "V",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 29,
              "el": 1,
              "sc": 21,
              "sl": 1,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 19,
              "el": 1,
              "sc": 16,
              "sl": 1,
            },
            "value": "Real",
          },
        ],
        "span": {
          "ec": 19,
          "el": 1,
          "sc": 16,
          "sl": 1,
        },
      },
      "doc_string": null,
      "kind": "scalar",
      "metadata": null,
      "name": {
        "span": {
          "ec": 12,
          "el": 1,
          "sc": 6,
          "sl": 1,
        },
        "value": "Voltage",
      },
      "source": {
        "file": "expressions",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 1,
        "sc": 1,
        "sl": 1,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "expressions",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse expressions 2`] = `"type Voltage = Real(units="V", b=[5k, 5%2], c=(true and false), d=f(5, 6, x=5e+2), e=d.a, f=1k+1m, g=Resistor(R=10.0))"`;

exports[`Test Dyad Parser Parse models 1`] = `
{
  "definitions": [
    {
      "dims": [],
      "doc_string": null,
      "kind": "sclcon",
      "metadata": {
        "kind": "meta",
        "span": {
          "ec": 99,
          "el": 1,
          "sc": 34,
          "sl": 1,
        },
        "value": {
          "Dyad": {
            "icons": {
              "default": "dyad://Dyad/input.svg",
            },
          },
        },
      },
      "name": {
        "span": {
          "ec": 19,
          "el": 1,
          "sc": 11,
          "sl": 1,
        },
        "value": "RealInput",
      },
      "qualifier": "input",
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 19,
        "el": 1,
        "sc": 11,
        "sl": 1,
      },
      "type": {
        "kind": "qtype",
        "mods": null,
        "name": [
          {
            "span": {
              "ec": 32,
              "el": 1,
              "sc": 29,
              "sl": 1,
            },
            "value": "Real",
          },
        ],
        "span": {
          "ec": 32,
          "el": 1,
          "sc": 29,
          "sl": 1,
        },
      },
    },
    {
      "declarations": {
        "g": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 9,
                  "el": 4,
                  "sc": 7,
                  "sl": 4,
                },
                "value": "Pin",
              },
            ],
            "span": {
              "ec": 9,
              "el": 4,
              "sc": 7,
              "sl": 4,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 3,
              "el": 4,
              "sc": 3,
              "sl": 4,
            },
            "value": "g",
          },
          "span": {
            "ec": 11,
            "el": 4,
            "sc": 3,
            "sl": 4,
          },
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 16,
          "el": 3,
          "sc": 11,
          "sl": 3,
        },
        "value": "Ground",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "g",
                "span": {
                  "ec": 3,
                  "el": 6,
                  "sc": 3,
                  "sl": 6,
                },
              },
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 5,
                  "el": 6,
                  "sc": 5,
                  "sl": 6,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "prefix": null,
            "repr": "0",
            "span": {
              "ec": 9,
              "el": 6,
              "sc": 9,
              "sl": 6,
            },
            "type": "ilit",
            "value": 0,
          },
          "span": {
            "ec": 9,
            "el": 6,
            "sc": 3,
            "sl": 6,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 7,
        "sc": 1,
        "sl": 3,
      },
    },
    {
      "declarations": {
        "i": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 13,
              "sc": 12,
              "sl": 13,
            },
            "value": "i",
          },
          "span": {
            "ec": 21,
            "el": 13,
            "sc": 3,
            "sl": 13,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 21,
                  "el": 13,
                  "sc": 15,
                  "sl": 13,
                },
                "value": "Current",
              },
            ],
            "span": {
              "ec": 21,
              "el": 13,
              "sc": 15,
              "sl": 13,
            },
          },
          "variability": "variable",
        },
        "n": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 9,
                  "el": 11,
                  "sc": 7,
                  "sl": 11,
                },
                "value": "Pin",
              },
            ],
            "span": {
              "ec": 9,
              "el": 11,
              "sc": 7,
              "sl": 11,
            },
          },
          "kind": "cdecl",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 43,
              "el": 11,
              "sc": 13,
              "sl": 11,
            },
            "value": {
              "Dyad": {
                "iconName": "neg",
              },
            },
          },
          "name": {
            "span": {
              "ec": 3,
              "el": 11,
              "sc": 3,
              "sl": 11,
            },
            "value": "n",
          },
          "span": {
            "ec": 43,
            "el": 11,
            "sc": 3,
            "sl": 11,
          },
        },
        "p": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 9,
                  "el": 10,
                  "sc": 7,
                  "sl": 10,
                },
                "value": "Pin",
              },
            ],
            "span": {
              "ec": 9,
              "el": 10,
              "sc": 7,
              "sl": 10,
            },
          },
          "kind": "cdecl",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 43,
              "el": 10,
              "sc": 13,
              "sl": 10,
            },
            "value": {
              "Dyad": {
                "iconName": "pos",
              },
            },
          },
          "name": {
            "span": {
              "ec": 3,
              "el": 10,
              "sc": 3,
              "sl": 10,
            },
            "value": "p",
          },
          "span": {
            "ec": 43,
            "el": 10,
            "sc": 3,
            "sl": 10,
          },
        },
        "v": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 12,
              "sc": 12,
              "sl": 12,
            },
            "value": "v",
          },
          "span": {
            "ec": 28,
            "el": 12,
            "sc": 3,
            "sl": 12,
          },
          "type": {
            "kind": "qtype",
            "mods": {
              "min": {
                "expr": {
                  "prefix": null,
                  "repr": "0",
                  "span": {
                    "ec": 27,
                    "el": 12,
                    "sc": 27,
                    "sl": 12,
                  },
                  "type": "ilit",
                  "value": 0,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 27,
                  "el": 12,
                  "sc": 23,
                  "sl": 12,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 21,
                  "el": 12,
                  "sc": 15,
                  "sl": 12,
                },
                "value": "Voltage",
              },
            ],
            "span": {
              "ec": 21,
              "el": 12,
              "sc": 15,
              "sl": 12,
            },
          },
          "variability": "variable",
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 24,
          "el": 9,
          "sc": 19,
          "sl": 9,
        },
        "value": "TwoPin",
      },
      "qualifier": "partial",
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 3,
                  "el": 15,
                  "sc": 3,
                  "sl": 15,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 7,
                    "el": 15,
                    "sc": 7,
                    "sl": 15,
                  },
                },
                {
                  "indices": [],
                  "name": "v",
                  "span": {
                    "ec": 9,
                    "el": 15,
                    "sc": 9,
                    "sl": 15,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "-",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 11,
                    "el": 15,
                    "sc": 11,
                    "sl": 15,
                  },
                },
                {
                  "indices": [],
                  "name": "V",
                  "span": {
                    "ec": 13,
                    "el": 15,
                    "sc": 13,
                    "sl": 15,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 13,
            "el": 15,
            "sc": 3,
            "sl": 15,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "i",
                "span": {
                  "ec": 3,
                  "el": 16,
                  "sc": 3,
                  "sl": 16,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "p",
                "span": {
                  "ec": 7,
                  "el": 16,
                  "sc": 7,
                  "sl": 16,
                },
              },
              {
                "indices": [],
                "name": "i",
                "span": {
                  "ec": 9,
                  "el": 16,
                  "sc": 9,
                  "sl": 16,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 9,
            "el": 16,
            "sc": 3,
            "sl": 16,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": {
            "span": {
              "ec": 27,
              "el": 17,
              "sc": 3,
              "sl": 17,
            },
            "value": "Conservation of Charge",
          },
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 3,
                    "el": 18,
                    "sc": 3,
                    "sl": 18,
                  },
                },
                {
                  "indices": [],
                  "name": "i",
                  "span": {
                    "ec": 5,
                    "el": 18,
                    "sc": 5,
                    "sl": 18,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "+",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 7,
                    "el": 18,
                    "sc": 7,
                    "sl": 18,
                  },
                },
                {
                  "indices": [],
                  "name": "i",
                  "span": {
                    "ec": 9,
                    "el": 18,
                    "sc": 9,
                    "sl": 18,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "prefix": null,
            "repr": "0",
            "span": {
              "ec": 13,
              "el": 18,
              "sc": 13,
              "sl": 18,
            },
            "type": "ilit",
            "value": 0,
          },
          "span": {
            "ec": 13,
            "el": 18,
            "sc": 3,
            "sl": 18,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 19,
        "sc": 1,
        "sl": 9,
      },
    },
    {
      "declarations": {
        "Vf": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": null,
            "repr": "10",
            "span": {
              "ec": 28,
              "el": 23,
              "sc": 27,
              "sl": 23,
            },
            "type": "ilit",
            "value": 10,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 14,
              "el": 23,
              "sc": 13,
              "sl": 23,
            },
            "value": "Vf",
          },
          "span": {
            "ec": 28,
            "el": 23,
            "sc": 3,
            "sl": 23,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 23,
                  "sc": 17,
                  "sl": 23,
                },
                "value": "Voltage",
              },
            ],
            "span": {
              "ec": 23,
              "el": 23,
              "sc": 17,
              "sl": 23,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 22,
                "sc": 11,
                "sl": 22,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 22,
            "sc": 11,
            "sl": 22,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 23,
          "el": 21,
          "sc": 11,
          "sl": 21,
        },
        "value": "VoltageSource",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 8,
                  "el": 25,
                  "sc": 8,
                  "sl": 25,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": {
            "span": {
              "ec": 51,
              "el": 25,
              "sc": 3,
              "sl": 25,
            },
            "value": "src",
          },
          "rhs": {
            "cond": {
              "elementwise": false,
              "lhs": {
                "elems": [
                  {
                    "indices": [],
                    "name": "t",
                    "span": {
                      "ec": 15,
                      "el": 25,
                      "sc": 15,
                      "sl": 25,
                    },
                  },
                ],
                "type": "cref",
              },
              "op": "<",
              "rhs": {
                "prefix": null,
                "repr": "0",
                "span": {
                  "ec": 17,
                  "el": 25,
                  "sc": 17,
                  "sl": 25,
                },
                "type": "ilit",
                "value": 0,
              },
              "type": "bexp",
            },
            "no": {
              "cond": {
                "elementwise": false,
                "lhs": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "t",
                      "span": {
                        "ec": 34,
                        "el": 25,
                        "sc": 34,
                        "sl": 25,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "op": ">",
                "rhs": {
                  "prefix": null,
                  "repr": "5",
                  "span": {
                    "ec": 36,
                    "el": 25,
                    "sc": 36,
                    "sl": 25,
                  },
                  "type": "ilit",
                  "value": 5,
                },
                "type": "bexp",
              },
              "no": {
                "elems": [
                  {
                    "indices": [],
                    "name": "Vf",
                    "span": {
                      "ec": 51,
                      "el": 25,
                      "sc": 50,
                      "sl": 25,
                    },
                  },
                ],
                "type": "cref",
              },
              "type": "texp",
              "yes": {
                "prefix": null,
                "repr": "7",
                "span": {
                  "ec": 43,
                  "el": 25,
                  "sc": 43,
                  "sl": 25,
                },
                "type": "ilit",
                "value": 7,
              },
            },
            "type": "texp",
            "yes": {
              "prefix": null,
              "repr": "0",
              "span": {
                "ec": 24,
                "el": 25,
                "sc": 24,
                "sl": 25,
              },
              "type": "ilit",
              "value": 0,
            },
          },
          "span": {
            "ec": 51,
            "el": 25,
            "sc": 3,
            "sl": 25,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 26,
        "sc": 1,
        "sl": 21,
      },
    },
    {
      "declarations": {
        "C": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 30,
              "sc": 13,
              "sl": 30,
            },
            "value": "C",
          },
          "span": {
            "ec": 26,
            "el": 30,
            "sc": 3,
            "sl": 30,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 30,
                  "sc": 16,
                  "sl": 30,
                },
                "value": "Capacitance",
              },
            ],
            "span": {
              "ec": 26,
              "el": 30,
              "sc": 16,
              "sl": 30,
            },
          },
          "variability": "parameter",
        },
        "altC": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": true,
          "init": {
            "elems": [
              {
                "indices": [],
                "name": "C",
                "span": {
                  "ec": 39,
                  "el": 31,
                  "sc": 39,
                  "sl": 31,
                },
              },
            ],
            "type": "cref",
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 22,
              "el": 31,
              "sc": 19,
              "sl": 31,
            },
            "value": "altC",
          },
          "span": {
            "ec": 39,
            "el": 31,
            "sc": 3,
            "sl": 31,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 35,
                  "el": 31,
                  "sc": 25,
                  "sl": 31,
                },
                "value": "Capacitance",
              },
            ],
            "span": {
              "ec": 35,
              "el": 31,
              "sc": 25,
              "sl": 31,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 29,
                "sc": 11,
                "sl": 29,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 29,
            "sc": 11,
            "sl": 29,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 19,
          "el": 28,
          "sc": 11,
          "sl": 28,
        },
        "value": "Capacitor",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": true,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 11,
                  "el": 33,
                  "sc": 11,
                  "sl": 33,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "prefix": null,
            "repr": "0",
            "span": {
              "ec": 15,
              "el": 33,
              "sc": 15,
              "sl": 33,
            },
            "type": "ilit",
            "value": 0,
          },
          "span": {
            "ec": 15,
            "el": 33,
            "sc": 3,
            "sl": 33,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "C",
                  "span": {
                    "ec": 3,
                    "el": 34,
                    "sc": 3,
                    "sl": 34,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "*",
            "rhs": {
              "func": {
                "elems": [
                  {
                    "indices": [],
                    "name": "der",
                    "span": {
                      "ec": 7,
                      "el": 34,
                      "sc": 5,
                      "sl": 34,
                    },
                  },
                ],
                "type": "cref",
              },
              "keyword": {},
              "positional": [
                {
                  "elems": [
                    {
                      "indices": [],
                      "name": "v",
                      "span": {
                        "ec": 9,
                        "el": 34,
                        "sc": 9,
                        "sl": 34,
                      },
                    },
                  ],
                  "type": "cref",
                },
              ],
              "span": {
                "ec": 10,
                "el": 34,
                "sc": 5,
                "sl": 34,
              },
              "type": "call",
            },
            "type": "bexp",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "i",
                "span": {
                  "ec": 14,
                  "el": 34,
                  "sc": 14,
                  "sl": 34,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 14,
            "el": 34,
            "sc": 3,
            "sl": 34,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "expr": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "v",
                  "span": {
                    "ec": 10,
                    "el": 35,
                    "sc": 10,
                    "sl": 35,
                  },
                },
              ],
              "type": "cref",
            },
            "op": ">",
            "rhs": {
              "prefix": null,
              "repr": "0",
              "span": {
                "ec": 12,
                "el": 35,
                "sc": 12,
                "sl": 35,
              },
              "type": "ilit",
              "value": 0,
            },
            "type": "bexp",
          },
          "kind": "assert",
          "message": "voltage should not be positive",
          "metadata": null,
          "span": {
            "ec": 47,
            "el": 35,
            "sc": 3,
            "sl": 35,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 36,
        "sc": 1,
        "sl": 28,
      },
    },
    {
      "declarations": {
        "L": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 40,
              "sc": 13,
              "sl": 40,
            },
            "value": "L",
          },
          "span": {
            "ec": 23,
            "el": 40,
            "sc": 3,
            "sl": 40,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 40,
                  "sc": 16,
                  "sl": 40,
                },
                "value": "Inductor",
              },
            ],
            "span": {
              "ec": 23,
              "el": 40,
              "sc": 16,
              "sl": 40,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 39,
                "sc": 11,
                "sl": 39,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 39,
            "sc": 11,
            "sl": 39,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 18,
          "el": 38,
          "sc": 11,
          "sl": 38,
        },
        "value": "Inductor",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "L",
                  "span": {
                    "ec": 3,
                    "el": 42,
                    "sc": 3,
                    "sl": 42,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "*",
            "rhs": {
              "func": {
                "elems": [
                  {
                    "indices": [],
                    "name": "der",
                    "span": {
                      "ec": 7,
                      "el": 42,
                      "sc": 5,
                      "sl": 42,
                    },
                  },
                ],
                "type": "cref",
              },
              "keyword": {},
              "positional": [
                {
                  "elems": [
                    {
                      "indices": [],
                      "name": "i",
                      "span": {
                        "ec": 9,
                        "el": 42,
                        "sc": 9,
                        "sl": 42,
                      },
                    },
                  ],
                  "type": "cref",
                },
              ],
              "span": {
                "ec": 10,
                "el": 42,
                "sc": 5,
                "sl": 42,
              },
              "type": "call",
            },
            "type": "bexp",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 14,
                  "el": 42,
                  "sc": 14,
                  "sl": 42,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 14,
            "el": 42,
            "sc": 3,
            "sl": 42,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 43,
        "sc": 1,
        "sl": 38,
      },
    },
    {
      "declarations": {
        "R": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 26,
              "el": 50,
              "sc": 3,
              "sl": 48,
            },
            "value": "Resistance of this Resistor
I wonder if wrapping works for this
syntax out of the box",
          },
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 51,
              "sc": 13,
              "sl": 51,
            },
            "value": "R",
          },
          "span": {
            "ec": 25,
            "el": 51,
            "sc": 3,
            "sl": 48,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 51,
                  "sc": 16,
                  "sl": 51,
                },
                "value": "Resistance",
              },
            ],
            "span": {
              "ec": 25,
              "el": 51,
              "sc": 16,
              "sl": 51,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": {
        "span": {
          "ec": 33,
          "el": 45,
          "sc": 1,
          "sl": 45,
        },
        "value": "A simple linear resistor model",
      },
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 47,
                "sc": 11,
                "sl": 47,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 47,
            "sc": 11,
            "sl": 47,
          },
        },
      ],
      "kind": "cdef",
      "metadata": {
        "kind": "meta",
        "span": {
          "ec": 58,
          "el": 55,
          "sc": 1,
          "sl": 55,
        },
        "value": {
          "Dyad": {
            "icon": "model:./assets/resistor.svg",
          },
        },
      },
      "name": {
        "span": {
          "ec": 18,
          "el": 46,
          "sc": 11,
          "sl": 46,
        },
        "value": "Resistor",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": {
            "span": {
              "ec": 14,
              "el": 53,
              "sc": 3,
              "sl": 53,
            },
            "value": "Ohm's Law",
          },
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 3,
                  "el": 54,
                  "sc": 3,
                  "sl": 54,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "i",
                  "span": {
                    "ec": 7,
                    "el": 54,
                    "sc": 7,
                    "sl": 54,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "*",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "R",
                  "span": {
                    "ec": 9,
                    "el": 54,
                    "sc": 9,
                    "sl": 54,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 9,
            "el": 54,
            "sc": 3,
            "sl": 54,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 56,
        "sc": 1,
        "sl": 45,
      },
    },
    {
      "declarations": {
        "R": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 63,
              "sc": 13,
              "sl": 63,
            },
            "value": "R",
          },
          "span": {
            "ec": 25,
            "el": 63,
            "sc": 3,
            "sl": 63,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 63,
                  "sc": 16,
                  "sl": 63,
                },
                "value": "Resistance",
              },
            ],
            "span": {
              "ec": 25,
              "el": 63,
              "sc": 16,
              "sl": 63,
            },
          },
          "variability": "parameter",
        },
        "parallel": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 20,
              "el": 65,
              "sc": 13,
              "sl": 65,
            },
            "value": "parallel",
          },
          "span": {
            "ec": 25,
            "el": 65,
            "sc": 3,
            "sl": 65,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 65,
                  "sc": 23,
                  "sl": 65,
                },
                "value": "Int",
              },
            ],
            "span": {
              "ec": 25,
              "el": 65,
              "sc": 23,
              "sl": 65,
            },
          },
          "variability": "parameter",
        },
        "series": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 18,
              "el": 64,
              "sc": 13,
              "sl": 64,
            },
            "value": "series",
          },
          "span": {
            "ec": 23,
            "el": 64,
            "sc": 3,
            "sl": 64,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 64,
                  "sc": 21,
                  "sl": 64,
                },
                "value": "Int",
              },
            ],
            "span": {
              "ec": 23,
              "el": 64,
              "sc": 21,
              "sl": 64,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": {
        "span": {
          "ec": 9,
          "el": 60,
          "sc": 1,
          "sl": 58,
        },
        "value": "This is a comment with a deliberately empty line:

above.",
      },
      "extends": [
        {
          "kind": "qtype",
          "mods": {
            "p": {
              "expr": null,
              "final": false,
              "nested": {
                "v": {
                  "expr": null,
                  "final": false,
                  "nested": {
                    "guess": {
                      "expr": {
                        "prefix": null,
                        "repr": "1.0",
                        "span": {
                          "ec": 30,
                          "el": 62,
                          "sc": 28,
                          "sl": 62,
                        },
                        "type": "ilit",
                        "value": 1,
                      },
                      "final": false,
                      "nested": null,
                      "span": {
                        "ec": 30,
                        "el": 62,
                        "sc": 22,
                        "sl": 62,
                      },
                    },
                  },
                  "span": {
                    "ec": 31,
                    "el": 62,
                    "sc": 20,
                    "sl": 62,
                  },
                },
              },
              "span": {
                "ec": 32,
                "el": 62,
                "sc": 18,
                "sl": 62,
              },
            },
          },
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 62,
                "sc": 11,
                "sl": 62,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 62,
            "sc": 11,
            "sl": 62,
          },
        },
      ],
      "kind": "cdef",
      "metadata": {
        "kind": "meta",
        "span": {
          "ec": 57,
          "el": 66,
          "sc": 1,
          "sl": 66,
        },
        "value": {
          "Dyad": {
            "icon": "model:./assets/battery.svg",
          },
        },
      },
      "name": {
        "span": {
          "ec": 26,
          "el": 61,
          "sc": 20,
          "sl": 61,
        },
        "value": "Battery",
      },
      "qualifier": "external",
      "relations": [],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 67,
        "sc": 1,
        "sl": 58,
      },
    },
    {
      "declarations": {
        "V": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 15,
                  "el": 71,
                  "sc": 7,
                  "sl": 71,
                },
                "value": "RealInput",
              },
            ],
            "span": {
              "ec": 15,
              "el": 71,
              "sc": 7,
              "sl": 71,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 3,
              "el": 71,
              "sc": 3,
              "sl": 71,
            },
            "value": "V",
          },
          "span": {
            "ec": 17,
            "el": 71,
            "sc": 3,
            "sl": 71,
          },
        },
      },
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 16,
                "el": 70,
                "sc": 11,
                "sl": 70,
              },
              "value": "TwoPin",
            },
          ],
          "span": {
            "ec": 16,
            "el": 70,
            "sc": 11,
            "sl": 70,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 23,
          "el": 69,
          "sc": 11,
          "sl": 69,
        },
        "value": "VoltageSource",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "v",
                "span": {
                  "ec": 3,
                  "el": 73,
                  "sc": 3,
                  "sl": 73,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elems": [
              {
                "indices": [],
                "name": "V",
                "span": {
                  "ec": 7,
                  "el": 73,
                  "sc": 7,
                  "sl": 73,
                },
              },
              {
                "indices": [],
                "name": "u",
                "span": {
                  "ec": 9,
                  "el": 73,
                  "sc": 9,
                  "sl": 73,
                },
              },
            ],
            "type": "cref",
          },
          "span": {
            "ec": 9,
            "el": 73,
            "sc": 3,
            "sl": 73,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "connectors": [
            {
              "elems": [
                {
                  "indices": [],
                  "name": "V",
                  "span": {
                    "ec": 23,
                    "el": 75,
                    "sc": 23,
                    "sl": 75,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "u",
                  "span": {
                    "ec": 26,
                    "el": 75,
                    "sc": 26,
                    "sl": 75,
                  },
                },
              ],
              "type": "cref",
            },
          ],
          "doc_string": {
            "span": {
              "ec": 37,
              "el": 74,
              "sc": 3,
              "sl": 74,
            },
            "value": "This signifies an analysis point",
          },
          "kind": "ap",
          "metadata": null,
          "name": {
            "span": {
              "ec": 27,
              "el": 75,
              "sc": 3,
              "sl": 75,
            },
            "value": "u_v",
          },
          "span": {
            "ec": 27,
            "el": 75,
            "sc": 3,
            "sl": 75,
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 76,
        "sc": 1,
        "sl": 69,
      },
    },
    {
      "declarations": {
        "source": {
          "cond": null,
          "constraint": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 16,
                  "el": 79,
                  "sc": 11,
                  "sl": 79,
                },
                "value": "TwoPin",
              },
            ],
            "span": {
              "ec": 16,
              "el": 79,
              "sc": 11,
              "sl": 79,
            },
          },
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "prefix": null,
                  "repr": "100",
                  "span": {
                    "ec": 33,
                    "el": 79,
                    "sc": 31,
                    "sl": 79,
                  },
                  "type": "ilit",
                  "value": 100,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 33,
                  "el": 79,
                  "sc": 29,
                  "sl": 79,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 27,
                  "el": 79,
                  "sc": 20,
                  "sl": 79,
                },
                "value": "Resistor",
              },
            ],
            "span": {
              "ec": 27,
              "el": 79,
              "sc": 20,
              "sl": 79,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 79,
              "sc": 3,
              "sl": 79,
            },
            "value": "source",
          },
          "span": {
            "ec": 34,
            "el": 79,
            "sc": 3,
            "sl": 79,
          },
        },
        "source2": {
          "cond": null,
          "constraint": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "prefix": null,
                  "repr": "200",
                  "span": {
                    "ec": 23,
                    "el": 80,
                    "sc": 21,
                    "sl": 80,
                  },
                  "type": "ilit",
                  "value": 200,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 23,
                  "el": 80,
                  "sc": 19,
                  "sl": 80,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 17,
                  "el": 80,
                  "sc": 12,
                  "sl": 80,
                },
                "value": "TwoPin",
              },
            ],
            "span": {
              "ec": 17,
              "el": 80,
              "sc": 12,
              "sl": 80,
            },
          },
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "prefix": null,
                  "repr": "100",
                  "span": {
                    "ec": 41,
                    "el": 80,
                    "sc": 39,
                    "sl": 80,
                  },
                  "type": "ilit",
                  "value": 100,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 41,
                  "el": 80,
                  "sc": 37,
                  "sl": 80,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 35,
                  "el": 80,
                  "sc": 28,
                  "sl": 80,
                },
                "value": "Resistor",
              },
            ],
            "span": {
              "ec": 35,
              "el": 80,
              "sc": 28,
              "sl": 80,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 9,
              "el": 80,
              "sc": 3,
              "sl": 80,
            },
            "value": "source2",
          },
          "span": {
            "ec": 42,
            "el": 80,
            "sc": 3,
            "sl": 80,
          },
        },
        "source3": {
          "cond": null,
          "constraint": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 17,
                  "el": 81,
                  "sc": 12,
                  "sl": 81,
                },
                "value": "TwoPin",
              },
            ],
            "span": {
              "ec": 17,
              "el": 81,
              "sc": 12,
              "sl": 81,
            },
          },
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "prefix": null,
                  "repr": "100",
                  "span": {
                    "ec": 36,
                    "el": 81,
                    "sc": 34,
                    "sl": 81,
                  },
                  "type": "ilit",
                  "value": 100,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 36,
                  "el": 81,
                  "sc": 32,
                  "sl": 81,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 30,
                  "el": 81,
                  "sc": 23,
                  "sl": 81,
                },
                "value": "Resistor",
              },
            ],
            "span": {
              "ec": 30,
              "el": 81,
              "sc": 23,
              "sl": 81,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 9,
              "el": 81,
              "sc": 3,
              "sl": 81,
            },
            "value": "source3",
          },
          "span": {
            "ec": 37,
            "el": 81,
            "sc": 3,
            "sl": 81,
          },
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 25,
          "el": 78,
          "sc": 19,
          "sl": 78,
        },
        "value": "Circuit",
      },
      "qualifier": "example",
      "relations": [],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 82,
        "sc": 1,
        "sl": 78,
      },
    },
    {
      "declarations": {},
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 17,
                "el": 85,
                "sc": 11,
                "sl": 85,
              },
              "value": "Circuit",
            },
          ],
          "span": {
            "ec": 17,
            "el": 85,
            "sc": 11,
            "sl": 85,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 23,
          "el": 84,
          "sc": 16,
          "sl": 84,
        },
        "value": "Circuit2",
      },
      "qualifier": "test",
      "relations": [],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 86,
        "sc": 1,
        "sl": 84,
      },
    },
    {
      "declarations": {
        "init": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 16,
              "el": 89,
              "sc": 13,
              "sl": 89,
            },
            "value": "init",
          },
          "span": {
            "ec": 39,
            "el": 89,
            "sc": 3,
            "sl": 89,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 39,
                  "el": 89,
                  "sc": 19,
                  "sl": 89,
                },
                "value": "InitializationOptions",
              },
            ],
            "span": {
              "ec": 39,
              "el": 89,
              "sc": 19,
              "sl": 89,
            },
          },
          "variability": "parameter",
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 14,
          "el": 88,
          "sc": 11,
          "sl": 88,
        },
        "value": "Mass",
      },
      "qualifier": null,
      "relations": [
        {
          "cases": [
            {
              "caseid": {
                "span": {
                  "ec": 22,
                  "el": 93,
                  "sc": 10,
                  "sl": 93,
                },
                "value": "FixedPosition",
              },
              "doc_string": null,
              "kind": "casec",
              "metadata": null,
              "rels": [
                {
                  "doc_string": null,
                  "initial": true,
                  "kind": "eq",
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "s",
                        "span": {
                          "ec": 15,
                          "el": 94,
                          "sc": 15,
                          "sl": 94,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "metadata": null,
                  "name": null,
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "init",
                        "span": {
                          "ec": 22,
                          "el": 94,
                          "sc": 19,
                          "sl": 94,
                        },
                      },
                      {
                        "indices": [],
                        "name": "s",
                        "span": {
                          "ec": 24,
                          "el": 94,
                          "sc": 24,
                          "sl": 94,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "span": {
                    "ec": 24,
                    "el": 94,
                    "sc": 7,
                    "sl": 94,
                  },
                  "when": {
                    "span": null,
                    "type": "blit",
                    "value": true,
                  },
                },
              ],
              "span": {
                "ec": 7,
                "el": 95,
                "sc": 5,
                "sl": 93,
              },
            },
            {
              "caseid": {
                "span": {
                  "ec": 30,
                  "el": 96,
                  "sc": 10,
                  "sl": 96,
                },
                "value": "FixedSpeedAndPosition",
              },
              "doc_string": null,
              "kind": "casec",
              "metadata": null,
              "rels": [
                {
                  "doc_string": null,
                  "initial": true,
                  "kind": "eq",
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "s",
                        "span": {
                          "ec": 15,
                          "el": 97,
                          "sc": 15,
                          "sl": 97,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "metadata": null,
                  "name": null,
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "init",
                        "span": {
                          "ec": 22,
                          "el": 97,
                          "sc": 19,
                          "sl": 97,
                        },
                      },
                      {
                        "indices": [],
                        "name": "s",
                        "span": {
                          "ec": 24,
                          "el": 97,
                          "sc": 24,
                          "sl": 97,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "span": {
                    "ec": 24,
                    "el": 97,
                    "sc": 7,
                    "sl": 97,
                  },
                  "when": {
                    "span": null,
                    "type": "blit",
                    "value": true,
                  },
                },
                {
                  "doc_string": null,
                  "initial": true,
                  "kind": "eq",
                  "lhs": {
                    "func": {
                      "elems": [
                        {
                          "indices": [],
                          "name": "der",
                          "span": {
                            "ec": 17,
                            "el": 98,
                            "sc": 15,
                            "sl": 98,
                          },
                        },
                      ],
                      "type": "cref",
                    },
                    "keyword": {},
                    "positional": [
                      {
                        "elems": [
                          {
                            "indices": [],
                            "name": "s",
                            "span": {
                              "ec": 19,
                              "el": 98,
                              "sc": 19,
                              "sl": 98,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                    ],
                    "span": {
                      "ec": 20,
                      "el": 98,
                      "sc": 15,
                      "sl": 98,
                    },
                    "type": "call",
                  },
                  "metadata": null,
                  "name": null,
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "init",
                        "span": {
                          "ec": 27,
                          "el": 98,
                          "sc": 24,
                          "sl": 98,
                        },
                      },
                      {
                        "indices": [],
                        "name": "v",
                        "span": {
                          "ec": 29,
                          "el": 98,
                          "sc": 29,
                          "sl": 98,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "span": {
                    "ec": 29,
                    "el": 98,
                    "sc": 7,
                    "sl": 98,
                  },
                  "when": {
                    "span": null,
                    "type": "blit",
                    "value": true,
                  },
                },
              ],
              "span": {
                "ec": 7,
                "el": 99,
                "sc": 5,
                "sl": 96,
              },
            },
            {
              "caseid": {
                "span": {
                  "ec": 20,
                  "el": 100,
                  "sc": 10,
                  "sl": 100,
                },
                "value": "Equilibrium",
              },
              "doc_string": null,
              "kind": "casec",
              "metadata": null,
              "rels": [
                {
                  "doc_string": null,
                  "initial": true,
                  "kind": "eq",
                  "lhs": {
                    "func": {
                      "elems": [
                        {
                          "indices": [],
                          "name": "der",
                          "span": {
                            "ec": 17,
                            "el": 101,
                            "sc": 15,
                            "sl": 101,
                          },
                        },
                      ],
                      "type": "cref",
                    },
                    "keyword": {},
                    "positional": [
                      {
                        "elems": [
                          {
                            "indices": [],
                            "name": "s",
                            "span": {
                              "ec": 19,
                              "el": 101,
                              "sc": 19,
                              "sl": 101,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                    ],
                    "span": {
                      "ec": 20,
                      "el": 101,
                      "sc": 15,
                      "sl": 101,
                    },
                    "type": "call",
                  },
                  "metadata": null,
                  "name": null,
                  "rhs": {
                    "prefix": null,
                    "repr": "0",
                    "span": {
                      "ec": 24,
                      "el": 101,
                      "sc": 24,
                      "sl": 101,
                    },
                    "type": "ilit",
                    "value": 0,
                  },
                  "span": {
                    "ec": 24,
                    "el": 101,
                    "sc": 7,
                    "sl": 101,
                  },
                  "when": {
                    "span": null,
                    "type": "blit",
                    "value": true,
                  },
                },
              ],
              "span": {
                "ec": 7,
                "el": 102,
                "sc": 5,
                "sl": 100,
              },
            },
            {
              "caseid": {
                "span": {
                  "ec": 11,
                  "el": 103,
                  "sc": 5,
                  "sl": 103,
                },
                "value": "default",
              },
              "doc_string": null,
              "kind": "casec",
              "metadata": null,
              "rels": [
                {
                  "doc_string": null,
                  "initial": true,
                  "kind": "eq",
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "s",
                        "span": {
                          "ec": 15,
                          "el": 104,
                          "sc": 15,
                          "sl": 104,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "metadata": null,
                  "name": null,
                  "rhs": {
                    "prefix": null,
                    "repr": "10",
                    "span": {
                      "ec": 20,
                      "el": 104,
                      "sc": 19,
                      "sl": 104,
                    },
                    "type": "ilit",
                    "value": 10,
                  },
                  "span": {
                    "ec": 20,
                    "el": 104,
                    "sc": 7,
                    "sl": 104,
                  },
                  "when": {
                    "span": null,
                    "type": "blit",
                    "value": true,
                  },
                },
              ],
              "span": {
                "ec": 7,
                "el": 105,
                "sc": 5,
                "sl": 103,
              },
            },
          ],
          "doc_string": {
            "span": {
              "ec": 54,
              "el": 91,
              "sc": 3,
              "sl": 91,
            },
            "value": "This handles various initialization contingencies",
          },
          "kind": "sw",
          "metadata": null,
          "name": null,
          "span": {
            "ec": 5,
            "el": 106,
            "sc": 3,
            "sl": 92,
          },
          "val": {
            "elems": [
              {
                "indices": [],
                "name": "init",
                "span": {
                  "ec": 13,
                  "el": 92,
                  "sc": 10,
                  "sl": 92,
                },
              },
            ],
            "type": "cref",
          },
        },
      ],
      "source": {
        "file": "models",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 107,
        "sc": 1,
        "sl": 88,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "models",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse models 2`] = `
"connector RealInput = input Real

component Ground
  g = Pin()
relations
  g.v = 0
end

partial component TwoPin
  p = Pin()
  n = Pin()
  variable v::Voltage(min=0)
  variable i::Current
relations
  v = p.v-n.V
  i = p.i
  p.i+n.i = 0
end

component VoltageSource
  extends TwoPin()
  parameter Vf::Voltage = 10
relations
  src: v = if t<0 then 0 else if t>5 then 7 else Vf
end

component Capacitor
  extends TwoPin()
  parameter C::Capacitance
  final parameter altC::Capacitance = C
relations
  initial v = 0
  C*der(v) = i
  assert(v>0, "voltage should not be positive")
end

component Inductor
  extends TwoPin()
  parameter L::Inductor
relations
  L*der(i) = v
end

component Resistor
  extends TwoPin()
  parameter R::Resistance
relations
  v = i*R
end

external component Battery
  extends TwoPin(p(v(guess=1.0)))
  parameter R::Resistance
  parameter series::Int
  parameter parallel::Int
end

component VoltageSource
  extends TwoPin()
  V = RealInput()
relations
  v = V.u
  u_v: analysis_point(V, u)
end

example component Circuit
  source::TwoPin = Resistor(R=100)
  source2::TwoPin(R=200) = Resistor(R=100)
  source3::TwoPin() = Resistor(R=100)
end

test component Circuit2
  extends Circuit
end

component Mass
  parameter init::InitializationOptions
relations
  switch init
    case FixedPosition
      initial s = init.s
    end
    case FixedSpeedAndPosition
      initial s = init.s
      initial der(s) = init.v
    end
    case Equilibrium
      initial der(s) = 0
    end
    default
      initial s = 10
    end
  end
end"
`;

exports[`Test Dyad Parser Parse orifice component 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "D": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 18,
              "el": 5,
              "sc": 3,
              "sl": 5,
            },
            "value": "pipe diameter",
          },
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 6,
              "sc": 13,
              "sl": 6,
            },
            "value": "D",
          },
          "span": {
            "ec": 23,
            "el": 6,
            "sc": 3,
            "sl": 5,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 6,
                  "sc": 16,
                  "sl": 6,
                },
                "value": "Diameter",
              },
            ],
            "span": {
              "ec": 23,
              "el": 6,
              "sc": 16,
              "sl": 6,
            },
          },
          "variability": "parameter",
        },
        "d": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 30,
              "el": 3,
              "sc": 3,
              "sl": 3,
            },
            "value": "internal orifice diameter",
          },
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 4,
              "sc": 13,
              "sl": 4,
            },
            "value": "d",
          },
          "span": {
            "ec": 23,
            "el": 4,
            "sc": 3,
            "sl": 3,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 4,
                  "sc": 16,
                  "sl": 4,
                },
                "value": "Diameter",
              },
            ],
            "span": {
              "ec": 23,
              "el": 4,
              "sc": 16,
              "sl": 4,
            },
          },
          "variability": "parameter",
        },
        "dp": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 13,
              "el": 7,
              "sc": 12,
              "sl": 7,
            },
            "value": "dp",
          },
          "span": {
            "ec": 23,
            "el": 7,
            "sc": 3,
            "sl": 7,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 7,
                  "sc": 16,
                  "sl": 7,
                },
                "value": "Pressure",
              },
            ],
            "span": {
              "ec": 23,
              "el": 7,
              "sc": 16,
              "sl": 7,
            },
          },
          "variability": "variable",
        },
        "rho_up": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 17,
              "el": 8,
              "sc": 12,
              "sl": 8,
            },
            "value": "rho_up",
          },
          "span": {
            "ec": 26,
            "el": 8,
            "sc": 3,
            "sl": 8,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 26,
                  "el": 8,
                  "sc": 20,
                  "sl": 8,
                },
                "value": "Density",
              },
            ],
            "span": {
              "ec": 26,
              "el": 8,
              "sc": 20,
              "sl": 8,
            },
          },
          "variability": "variable",
        },
        "Œ≤": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": null,
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 12,
              "el": 9,
              "sc": 12,
              "sl": 9,
            },
            "value": "Œ≤",
          },
          "span": {
            "ec": 18,
            "el": 9,
            "sc": 3,
            "sl": 9,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 18,
                  "el": 9,
                  "sc": 15,
                  "sl": 9,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 18,
              "el": 9,
              "sc": 15,
              "sl": 9,
            },
          },
          "variability": "variable",
        },
      },
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {},
          "name": [
            {
              "span": {
                "ec": 17,
                "el": 2,
                "sc": 11,
                "sl": 2,
              },
              "value": "TwoPort",
            },
          ],
          "span": {
            "ec": 17,
            "el": 2,
            "sc": 11,
            "sl": 2,
          },
        },
      ],
      "kind": "cdef",
      "metadata": {
        "kind": "meta",
        "span": {
          "ec": 1,
          "el": 28,
          "sc": 1,
          "sl": 16,
        },
        "value": {
          "Dyad": {
            "icons": {
              "default": "dyad://Hydraulics/Orifice.svg",
            },
            "tests": {
              "case1": {
                "atol": {
                  "pt2.y": 0.01,
                },
                "expect": {
                  "final": {
                    "pt2.y": 1,
                  },
                  "signals": [
                    "pt2.y",
                  ],
                },
                "initial": {
                  "pt2.xd": 0,
                },
                "stop": 10,
              },
            },
          },
        },
      },
      "name": {
        "span": {
          "ec": 17,
          "el": 1,
          "sc": 11,
          "sl": 1,
        },
        "value": "Orifice",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "Œ≤",
                "span": {
                  "ec": 3,
                  "el": 11,
                  "sc": 3,
                  "sl": 11,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "d",
                  "span": {
                    "ec": 7,
                    "el": 11,
                    "sc": 7,
                    "sl": 11,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "/",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "D",
                  "span": {
                    "ec": 9,
                    "el": 11,
                    "sc": 9,
                    "sl": 11,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 9,
            "el": 11,
            "sc": 3,
            "sl": 11,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "rho_up",
                "span": {
                  "ec": 8,
                  "el": 12,
                  "sc": 3,
                  "sl": 12,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "rho0",
                  "span": {
                    "ec": 15,
                    "el": 12,
                    "sc": 12,
                    "sl": 12,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "+",
            "rhs": {
              "expr": {
                "cond": {
                  "elementwise": false,
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "port_a",
                        "span": {
                          "ec": 26,
                          "el": 12,
                          "sc": 21,
                          "sl": 12,
                        },
                      },
                      {
                        "indices": [],
                        "name": "p",
                        "span": {
                          "ec": 28,
                          "el": 12,
                          "sc": 28,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "op": ">",
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "port_b",
                        "span": {
                          "ec": 35,
                          "el": 12,
                          "sc": 30,
                          "sl": 12,
                        },
                      },
                      {
                        "indices": [],
                        "name": "p",
                        "span": {
                          "ec": 37,
                          "el": 12,
                          "sc": 37,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "type": "bexp",
                },
                "no": {
                  "elementwise": false,
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "port_b",
                        "span": {
                          "ec": 68,
                          "el": 12,
                          "sc": 63,
                          "sl": 12,
                        },
                      },
                      {
                        "indices": [],
                        "name": "p",
                        "span": {
                          "ec": 70,
                          "el": 12,
                          "sc": 70,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "op": "/",
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "beta",
                        "span": {
                          "ec": 75,
                          "el": 12,
                          "sc": 72,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "type": "bexp",
                },
                "type": "texp",
                "yes": {
                  "elementwise": false,
                  "lhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "port_a",
                        "span": {
                          "ec": 49,
                          "el": 12,
                          "sc": 44,
                          "sl": 12,
                        },
                      },
                      {
                        "indices": [],
                        "name": "p",
                        "span": {
                          "ec": 51,
                          "el": 12,
                          "sc": 51,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "op": "/",
                  "rhs": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "beta",
                        "span": {
                          "ec": 56,
                          "el": 12,
                          "sc": 53,
                          "sl": 12,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "type": "bexp",
                },
              },
              "span": {
                "ec": 76,
                "el": 12,
                "sc": 17,
                "sl": 12,
              },
              "type": "paren",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 76,
            "el": 12,
            "sc": 3,
            "sl": 12,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "dp",
                "span": {
                  "ec": 4,
                  "el": 13,
                  "sc": 3,
                  "sl": 13,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "port_a",
                  "span": {
                    "ec": 13,
                    "el": 13,
                    "sc": 8,
                    "sl": 13,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 15,
                    "el": 13,
                    "sc": 15,
                    "sl": 13,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "-",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "port_b",
                  "span": {
                    "ec": 22,
                    "el": 13,
                    "sc": 17,
                    "sl": 13,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 24,
                    "el": 13,
                    "sc": 24,
                    "sl": 13,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 24,
            "el": 13,
            "sc": 3,
            "sl": 13,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elems": [
              {
                "indices": [],
                "name": "port_a",
                "span": {
                  "ec": 8,
                  "el": 14,
                  "sc": 3,
                  "sl": 14,
                },
              },
              {
                "indices": [],
                "name": "m_dot",
                "span": {
                  "ec": 14,
                  "el": 14,
                  "sc": 10,
                  "sl": 14,
                },
              },
            ],
            "type": "cref",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "elementwise": false,
            "lhs": {
              "elementwise": false,
              "lhs": {
                "elementwise": false,
                "lhs": {
                  "elementwise": false,
                  "lhs": {
                    "elementwise": false,
                    "lhs": {
                      "elementwise": false,
                      "lhs": {
                        "elems": [
                          {
                            "indices": [],
                            "name": "C_d",
                            "span": {
                              "ec": 20,
                              "el": 14,
                              "sc": 18,
                              "sl": 14,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                      "op": "*",
                      "rhs": {
                        "elems": [
                          {
                            "indices": [],
                            "name": "eps",
                            "span": {
                              "ec": 24,
                              "el": 14,
                              "sc": 22,
                              "sl": 14,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                      "type": "bexp",
                    },
                    "op": "*",
                    "rhs": {
                      "elems": [
                        {
                          "indices": [],
                          "name": "pi",
                          "span": {
                            "ec": 27,
                            "el": 14,
                            "sc": 26,
                            "sl": 14,
                          },
                        },
                      ],
                      "type": "cref",
                    },
                    "type": "bexp",
                  },
                  "op": "*",
                  "rhs": {
                    "expr": {
                      "elementwise": false,
                      "lhs": {
                        "elems": [
                          {
                            "indices": [],
                            "name": "d",
                            "span": {
                              "ec": 30,
                              "el": 14,
                              "sc": 30,
                              "sl": 14,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                      "op": "^",
                      "rhs": {
                        "prefix": null,
                        "repr": "2",
                        "span": {
                          "ec": 32,
                          "el": 14,
                          "sc": 32,
                          "sl": 14,
                        },
                        "type": "ilit",
                        "value": 2,
                      },
                      "type": "bexp",
                    },
                    "span": {
                      "ec": 33,
                      "el": 14,
                      "sc": 29,
                      "sl": 14,
                    },
                    "type": "paren",
                  },
                  "type": "bexp",
                },
                "op": "*",
                "rhs": {
                  "func": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "sign",
                        "span": {
                          "ec": 38,
                          "el": 14,
                          "sc": 35,
                          "sl": 14,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "keyword": {},
                  "positional": [
                    {
                      "elementwise": false,
                      "lhs": {
                        "elementwise": false,
                        "lhs": {
                          "prefix": null,
                          "repr": "2",
                          "span": {
                            "ec": 40,
                            "el": 14,
                            "sc": 40,
                            "sl": 14,
                          },
                          "type": "ilit",
                          "value": 2,
                        },
                        "op": "*",
                        "rhs": {
                          "elems": [
                            {
                              "indices": [],
                              "name": "dp",
                              "span": {
                                "ec": 43,
                                "el": 14,
                                "sc": 42,
                                "sl": 14,
                              },
                            },
                          ],
                          "type": "cref",
                        },
                        "type": "bexp",
                      },
                      "op": "*",
                      "rhs": {
                        "elems": [
                          {
                            "indices": [],
                            "name": "rho_up",
                            "span": {
                              "ec": 50,
                              "el": 14,
                              "sc": 45,
                              "sl": 14,
                            },
                          },
                        ],
                        "type": "cref",
                      },
                      "type": "bexp",
                    },
                  ],
                  "span": {
                    "ec": 51,
                    "el": 14,
                    "sc": 35,
                    "sl": 14,
                  },
                  "type": "call",
                },
                "type": "bexp",
              },
              "op": "*",
              "rhs": {
                "func": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "sqrt",
                      "span": {
                        "ec": 56,
                        "el": 14,
                        "sc": 53,
                        "sl": 14,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "keyword": {},
                "positional": [
                  {
                    "func": {
                      "elems": [
                        {
                          "indices": [],
                          "name": "abs",
                          "span": {
                            "ec": 60,
                            "el": 14,
                            "sc": 58,
                            "sl": 14,
                          },
                        },
                      ],
                      "type": "cref",
                    },
                    "keyword": {},
                    "positional": [
                      {
                        "elementwise": false,
                        "lhs": {
                          "elementwise": false,
                          "lhs": {
                            "prefix": null,
                            "repr": "2",
                            "span": {
                              "ec": 62,
                              "el": 14,
                              "sc": 62,
                              "sl": 14,
                            },
                            "type": "ilit",
                            "value": 2,
                          },
                          "op": "*",
                          "rhs": {
                            "elems": [
                              {
                                "indices": [],
                                "name": "dp",
                                "span": {
                                  "ec": 65,
                                  "el": 14,
                                  "sc": 64,
                                  "sl": 14,
                                },
                              },
                            ],
                            "type": "cref",
                          },
                          "type": "bexp",
                        },
                        "op": "*",
                        "rhs": {
                          "elems": [
                            {
                              "indices": [],
                              "name": "rho_up",
                              "span": {
                                "ec": 72,
                                "el": 14,
                                "sc": 67,
                                "sl": 14,
                              },
                            },
                          ],
                          "type": "cref",
                        },
                        "type": "bexp",
                      },
                    ],
                    "span": {
                      "ec": 73,
                      "el": 14,
                      "sc": 58,
                      "sl": 14,
                    },
                    "type": "call",
                  },
                ],
                "span": {
                  "ec": 74,
                  "el": 14,
                  "sc": 53,
                  "sl": 14,
                },
                "type": "call",
              },
              "type": "bexp",
            },
            "op": "/",
            "rhs": {
              "expr": {
                "elementwise": false,
                "lhs": {
                  "prefix": null,
                  "repr": "4",
                  "span": {
                    "ec": 77,
                    "el": 14,
                    "sc": 77,
                    "sl": 14,
                  },
                  "type": "ilit",
                  "value": 4,
                },
                "op": "*",
                "rhs": {
                  "func": {
                    "elems": [
                      {
                        "indices": [],
                        "name": "sqrt",
                        "span": {
                          "ec": 82,
                          "el": 14,
                          "sc": 79,
                          "sl": 14,
                        },
                      },
                    ],
                    "type": "cref",
                  },
                  "keyword": {},
                  "positional": [
                    {
                      "elementwise": false,
                      "lhs": {
                        "prefix": null,
                        "repr": "1",
                        "span": {
                          "ec": 84,
                          "el": 14,
                          "sc": 84,
                          "sl": 14,
                        },
                        "type": "ilit",
                        "value": 1,
                      },
                      "op": "-",
                      "rhs": {
                        "elementwise": false,
                        "lhs": {
                          "elems": [
                            {
                              "indices": [],
                              "name": "beta",
                              "span": {
                                "ec": 89,
                                "el": 14,
                                "sc": 86,
                                "sl": 14,
                              },
                            },
                          ],
                          "type": "cref",
                        },
                        "op": "^",
                        "rhs": {
                          "prefix": null,
                          "repr": "4",
                          "span": {
                            "ec": 91,
                            "el": 14,
                            "sc": 91,
                            "sl": 14,
                          },
                          "type": "ilit",
                          "value": 4,
                        },
                        "type": "bexp",
                      },
                      "type": "bexp",
                    },
                  ],
                  "span": {
                    "ec": 92,
                    "el": 14,
                    "sc": 79,
                    "sl": 14,
                  },
                  "type": "call",
                },
                "type": "bexp",
              },
              "span": {
                "ec": 93,
                "el": 14,
                "sc": 76,
                "sl": 14,
              },
              "type": "paren",
            },
            "type": "bexp",
          },
          "span": {
            "ec": 93,
            "el": 14,
            "sc": 3,
            "sl": 14,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
        {
          "doc_string": null,
          "initial": false,
          "kind": "eq",
          "lhs": {
            "elementwise": false,
            "lhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "port_a",
                  "span": {
                    "ec": 8,
                    "el": 15,
                    "sc": 3,
                    "sl": 15,
                  },
                },
                {
                  "indices": [],
                  "name": "m_dot",
                  "span": {
                    "ec": 14,
                    "el": 15,
                    "sc": 10,
                    "sl": 15,
                  },
                },
              ],
              "type": "cref",
            },
            "op": "+",
            "rhs": {
              "elems": [
                {
                  "indices": [],
                  "name": "port_b",
                  "span": {
                    "ec": 21,
                    "el": 15,
                    "sc": 16,
                    "sl": 15,
                  },
                },
                {
                  "indices": [],
                  "name": "m_dot",
                  "span": {
                    "ec": 27,
                    "el": 15,
                    "sc": 23,
                    "sl": 15,
                  },
                },
              ],
              "type": "cref",
            },
            "type": "bexp",
          },
          "metadata": null,
          "name": null,
          "rhs": {
            "prefix": null,
            "repr": "0",
            "span": {
              "ec": 31,
              "el": 15,
              "sc": 31,
              "sl": 15,
            },
            "type": "ilit",
            "value": 0,
          },
          "span": {
            "ec": 31,
            "el": 15,
            "sc": 3,
            "sl": 15,
          },
          "when": {
            "span": null,
            "type": "blit",
            "value": true,
          },
        },
      ],
      "source": {
        "file": "orifice",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 29,
        "sc": 1,
        "sl": 1,
      },
    },
    {
      "declarations": {
        "hp": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "P": {
                "expr": {
                  "prefix": null,
                  "repr": "202650",
                  "span": {
                    "ec": 34,
                    "el": 32,
                    "sc": 29,
                    "sl": 32,
                  },
                  "type": "ilit",
                  "value": 202650,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 34,
                  "el": 32,
                  "sc": 27,
                  "sl": 32,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 32,
                  "sc": 8,
                  "sl": 32,
                },
                "value": "HydraulicReservoir",
              },
            ],
            "span": {
              "ec": 25,
              "el": 32,
              "sc": 8,
              "sl": 32,
            },
          },
          "kind": "cdecl",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 4,
              "el": 34,
              "sc": 37,
              "sl": 32,
            },
            "value": {
              "Dyad": {
                "placement": {
                  "diagram": {
                    "x1": 200,
                    "x2": 400,
                    "y1": 400,
                    "y2": 600,
                  },
                },
              },
            },
          },
          "name": {
            "span": {
              "ec": 4,
              "el": 32,
              "sc": 3,
              "sl": 32,
            },
            "value": "hp",
          },
          "span": {
            "ec": 4,
            "el": 34,
            "sc": 3,
            "sl": 32,
          },
        },
        "lp": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "P": {
                "expr": {
                  "prefix": null,
                  "repr": "101325",
                  "span": {
                    "ec": 34,
                    "el": 35,
                    "sc": 29,
                    "sl": 35,
                  },
                  "type": "ilit",
                  "value": 101325,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 34,
                  "el": 35,
                  "sc": 27,
                  "sl": 35,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 25,
                  "el": 35,
                  "sc": 8,
                  "sl": 35,
                },
                "value": "HydraulicReservoir",
              },
            ],
            "span": {
              "ec": 25,
              "el": 35,
              "sc": 8,
              "sl": 35,
            },
          },
          "kind": "cdecl",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 4,
              "el": 37,
              "sc": 37,
              "sl": 35,
            },
            "value": {
              "Dyad": {
                "placement": {
                  "diagram": {
                    "x1": 600,
                    "x2": 800,
                    "y1": 400,
                    "y2": 600,
                  },
                },
              },
            },
          },
          "name": {
            "span": {
              "ec": 4,
              "el": 35,
              "sc": 3,
              "sl": 35,
            },
            "value": "lp",
          },
          "span": {
            "ec": 4,
            "el": 37,
            "sc": 3,
            "sl": 35,
          },
        },
        "orifice": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 19,
                  "el": 38,
                  "sc": 13,
                  "sl": 38,
                },
                "value": "Orifice",
              },
            ],
            "span": {
              "ec": 19,
              "el": 38,
              "sc": 13,
              "sl": 38,
            },
          },
          "kind": "cdecl",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 4,
              "el": 40,
              "sc": 23,
              "sl": 38,
            },
            "value": {
              "Dyad": {
                "placement": {
                  "diagram": {
                    "x1": 500,
                    "x2": 600,
                    "y1": 400,
                    "y2": 600,
                  },
                },
              },
            },
          },
          "name": {
            "span": {
              "ec": 9,
              "el": 38,
              "sc": 3,
              "sl": 38,
            },
            "value": "orifice",
          },
          "span": {
            "ec": 4,
            "el": 40,
            "sc": 3,
            "sl": 38,
          },
        },
      },
      "doc_string": null,
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 21,
          "el": 31,
          "sc": 11,
          "sl": 31,
        },
        "value": "TestOrifice",
      },
      "qualifier": null,
      "relations": [],
      "source": {
        "file": "orifice",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 41,
        "sc": 1,
        "sl": 31,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "orifice",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse orifice component 2`] = `
"component Orifice
  extends TwoPort()
  parameter d::Diameter
  parameter D::Diameter
  variable dp::Pressure
  variable rho_up::Density
  variable Œ≤::Real
relations
  Œ≤ = d/D
  rho_up = rho0+(if port_a.p>port_b.p then port_a.p/beta else port_b.p/beta)
  dp = port_a.p-port_b.p
  port_a.m_dot = C_d*eps*pi*(d^2)*sign(2*dp*rho_up)*sqrt(abs(2*dp*rho_up))/(4*sqrt(1-beta^4))
  port_a.m_dot+port_b.m_dot = 0
end

component TestOrifice
  hp = HydraulicReservoir(P=202650)
  lp = HydraulicReservoir(P=101325)
  orifice = Orifice()
end"
`;

exports[`Test Dyad Parser Parse systems 1`] = `
{
  "definitions": [
    {
      "declarations": {
        "capacitor": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "C": {
                "expr": {
                  "prefix": "m",
                  "repr": "1m",
                  "span": {
                    "ec": 28,
                    "el": 5,
                    "sc": 27,
                    "sl": 5,
                  },
                  "type": "rlit",
                  "value": 0.001,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 28,
                  "el": 5,
                  "sc": 25,
                  "sl": 5,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 23,
                  "el": 5,
                  "sc": 15,
                  "sl": 5,
                },
                "value": "Capacitor",
              },
            ],
            "span": {
              "ec": 23,
              "el": 5,
              "sc": 15,
              "sl": 5,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 11,
              "el": 5,
              "sc": 3,
              "sl": 5,
            },
            "value": "capacitor",
          },
          "span": {
            "ec": 29,
            "el": 5,
            "sc": 3,
            "sl": 5,
          },
        },
        "ground": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 17,
                  "el": 8,
                  "sc": 12,
                  "sl": 8,
                },
                "value": "Ground",
              },
            ],
            "span": {
              "ec": 17,
              "el": 8,
              "sc": 12,
              "sl": 8,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 8,
              "sc": 3,
              "sl": 8,
            },
            "value": "ground",
          },
          "span": {
            "ec": 19,
            "el": 8,
            "sc": 3,
            "sl": 8,
          },
        },
        "inductor": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "L": {
                "expr": {
                  "prefix": null,
                  "repr": "1",
                  "span": {
                    "ec": 25,
                    "el": 6,
                    "sc": 25,
                    "sl": 6,
                  },
                  "type": "ilit",
                  "value": 1,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 25,
                  "el": 6,
                  "sc": 23,
                  "sl": 6,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 21,
                  "el": 6,
                  "sc": 14,
                  "sl": 6,
                },
                "value": "Inductor",
              },
            ],
            "span": {
              "ec": 21,
              "el": 6,
              "sc": 14,
              "sl": 6,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 10,
              "el": 6,
              "sc": 3,
              "sl": 6,
            },
            "value": "inductor",
          },
          "span": {
            "ec": 26,
            "el": 6,
            "sc": 3,
            "sl": 6,
          },
        },
        "resistor": {
          "cond": null,
          "constraint": null,
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "R": {
                "expr": {
                  "prefix": null,
                  "repr": "100",
                  "span": {
                    "ec": 48,
                    "el": 4,
                    "sc": 46,
                    "sl": 4,
                  },
                  "type": "ilit",
                  "value": 100,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 48,
                  "el": 4,
                  "sc": 44,
                  "sl": 4,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 42,
                  "el": 4,
                  "sc": 14,
                  "sl": 4,
                },
                "value": "ElectricalComponents",
              },
              {
                "span": {
                  "ec": 42,
                  "el": 4,
                  "sc": 35,
                  "sl": 4,
                },
                "value": "Resistor",
              },
            ],
            "span": {
              "ec": 42,
              "el": 4,
              "sc": 14,
              "sl": 4,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 10,
              "el": 4,
              "sc": 3,
              "sl": 4,
            },
            "value": "resistor",
          },
          "span": {
            "ec": 49,
            "el": 4,
            "sc": 3,
            "sl": 4,
          },
        },
        "source": {
          "cond": null,
          "constraint": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 16,
                  "el": 7,
                  "sc": 11,
                  "sl": 7,
                },
                "value": "TwoPin",
              },
            ],
            "span": {
              "ec": 16,
              "el": 7,
              "sc": 11,
              "sl": 7,
            },
          },
          "dims": [],
          "doc_string": null,
          "indices": [],
          "instance": {
            "kind": "qtype",
            "mods": {
              "Vf": {
                "expr": {
                  "prefix": null,
                  "repr": "24",
                  "span": {
                    "ec": 40,
                    "el": 7,
                    "sc": 39,
                    "sl": 7,
                  },
                  "type": "ilit",
                  "value": 24,
                },
                "final": false,
                "nested": null,
                "span": {
                  "ec": 40,
                  "el": 7,
                  "sc": 36,
                  "sl": 7,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 34,
                  "el": 7,
                  "sc": 22,
                  "sl": 7,
                },
                "value": "VoltageSource",
              },
            ],
            "span": {
              "ec": 34,
              "el": 7,
              "sc": 22,
              "sl": 7,
            },
          },
          "kind": "cdecl",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 7,
              "sc": 3,
              "sl": 7,
            },
            "value": "source",
          },
          "span": {
            "ec": 41,
            "el": 7,
            "sc": 3,
            "sl": 7,
          },
        },
        "x": {
          "cond": null,
          "dims": [],
          "doc_string": null,
          "final": false,
          "init": {
            "prefix": null,
            "repr": "1.1",
            "span": {
              "ec": 20,
              "el": 9,
              "sc": 18,
              "sl": 9,
            },
            "type": "rlit",
            "value": 1.1,
          },
          "kind": "var",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 9,
              "sc": 8,
              "sl": 9,
            },
            "value": "x",
          },
          "span": {
            "ec": 20,
            "el": 9,
            "sc": 3,
            "sl": 9,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 14,
                  "el": 9,
                  "sc": 11,
                  "sl": 9,
                },
                "value": "Real",
              },
            ],
            "span": {
              "ec": 14,
              "el": 9,
              "sc": 11,
              "sl": 9,
            },
          },
          "variability": "path",
        },
      },
      "doc_string": {
        "span": {
          "ec": 16,
          "el": 2,
          "sc": 1,
          "sl": 1,
        },
        "value": "This is an RLC model.  This should support markdown.  That includes
HTML as well.",
      },
      "extends": [],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 18,
          "el": 3,
          "sc": 11,
          "sl": 3,
        },
        "value": "RLCModel",
      },
      "qualifier": null,
      "relations": [
        {
          "doc_string": null,
          "kind": "cont",
          "metadata": null,
          "span": {
            "ec": 18,
            "el": 11,
            "sc": 3,
            "sl": 11,
          },
          "variables": [
            {
              "elems": [
                {
                  "indices": [],
                  "name": "x",
                  "span": {
                    "ec": 14,
                    "el": 11,
                    "sc": 14,
                    "sl": 11,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "x",
                  "span": {
                    "ec": 17,
                    "el": 11,
                    "sc": 17,
                    "sl": 11,
                  },
                },
              ],
              "type": "cref",
            },
          ],
        },
        {
          "connectors": [
            {
              "elems": [
                {
                  "indices": [],
                  "name": "source",
                  "span": {
                    "ec": 16,
                    "el": 12,
                    "sc": 11,
                    "sl": 12,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 18,
                    "el": 12,
                    "sc": 18,
                    "sl": 12,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "inductor",
                  "span": {
                    "ec": 28,
                    "el": 12,
                    "sc": 21,
                    "sl": 12,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 30,
                    "el": 12,
                    "sc": 30,
                    "sl": 12,
                  },
                },
              ],
              "type": "cref",
            },
          ],
          "doc_string": null,
          "kind": "cxn",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 58,
              "el": 12,
              "sc": 33,
              "sl": 12,
            },
            "value": {
              "Dyad": {
                "path": [
                  [],
                ],
              },
            },
          },
          "span": {
            "ec": 58,
            "el": 12,
            "sc": 3,
            "sl": 12,
          },
        },
        {
          "connectors": [
            {
              "elems": [
                {
                  "indices": [],
                  "name": "inductor",
                  "span": {
                    "ec": 18,
                    "el": 13,
                    "sc": 11,
                    "sl": 13,
                  },
                },
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 20,
                    "el": 13,
                    "sc": 20,
                    "sl": 13,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "resistor",
                  "span": {
                    "ec": 30,
                    "el": 13,
                    "sc": 23,
                    "sl": 13,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 32,
                    "el": 13,
                    "sc": 32,
                    "sl": 13,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "capacitor",
                  "span": {
                    "ec": 43,
                    "el": 13,
                    "sc": 35,
                    "sl": 13,
                  },
                },
                {
                  "indices": [],
                  "name": "p",
                  "span": {
                    "ec": 45,
                    "el": 13,
                    "sc": 45,
                    "sl": 13,
                  },
                },
              ],
              "type": "cref",
            },
          ],
          "doc_string": null,
          "kind": "cxn",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 4,
              "el": 15,
              "sc": 48,
              "sl": 13,
            },
            "value": {
              "Dyad": {
                "path": [
                  [
                    {
                      "x": 1,
                      "y": 10,
                    },
                  ],
                  [
                    {
                      "x": 5,
                      "y": 10,
                    },
                    {
                      "x": 5,
                      "y": 20,
                    },
                  ],
                ],
              },
            },
          },
          "span": {
            "ec": 4,
            "el": 15,
            "sc": 3,
            "sl": 13,
          },
        },
        {
          "connectors": [
            {
              "elems": [
                {
                  "indices": [],
                  "name": "resistor",
                  "span": {
                    "ec": 18,
                    "el": 16,
                    "sc": 11,
                    "sl": 16,
                  },
                },
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 20,
                    "el": 16,
                    "sc": 20,
                    "sl": 16,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "ground",
                  "span": {
                    "ec": 28,
                    "el": 16,
                    "sc": 23,
                    "sl": 16,
                  },
                },
                {
                  "indices": [],
                  "name": "g",
                  "span": {
                    "ec": 30,
                    "el": 16,
                    "sc": 30,
                    "sl": 16,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "capacitor",
                  "span": {
                    "ec": 41,
                    "el": 16,
                    "sc": 33,
                    "sl": 16,
                  },
                },
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 43,
                    "el": 16,
                    "sc": 43,
                    "sl": 16,
                  },
                },
              ],
              "type": "cref",
            },
            {
              "elems": [
                {
                  "indices": [],
                  "name": "source",
                  "span": {
                    "ec": 51,
                    "el": 16,
                    "sc": 46,
                    "sl": 16,
                  },
                },
                {
                  "indices": [],
                  "name": "n",
                  "span": {
                    "ec": 53,
                    "el": 16,
                    "sc": 53,
                    "sl": 16,
                  },
                },
              ],
              "type": "cref",
            },
          ],
          "doc_string": null,
          "kind": "cxn",
          "metadata": null,
          "span": {
            "ec": 54,
            "el": 16,
            "sc": 3,
            "sl": 16,
          },
        },
      ],
      "source": {
        "file": "systems",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 17,
        "sc": 1,
        "sl": 1,
      },
    },
    {
      "declarations": {},
      "doc_string": null,
      "extends": [
        {
          "kind": "qtype",
          "mods": {
            "source": {
              "expr": {
                "func": {
                  "elems": [
                    {
                      "indices": [],
                      "name": "CurrentSource",
                      "span": {
                        "ec": 39,
                        "el": 20,
                        "sc": 27,
                        "sl": 20,
                      },
                    },
                  ],
                  "type": "cref",
                },
                "keyword": {
                  "i_final": {
                    "prefix": "m",
                    "repr": "1.5m",
                    "span": {
                      "ec": 52,
                      "el": 20,
                      "sc": 49,
                      "sl": 20,
                    },
                    "type": "rlit",
                    "value": 0.0015,
                  },
                },
                "positional": [],
                "span": {
                  "ec": 53,
                  "el": 20,
                  "sc": 27,
                  "sl": 20,
                },
                "type": "call",
              },
              "final": false,
              "nested": null,
              "span": {
                "ec": 53,
                "el": 20,
                "sc": 20,
                "sl": 20,
              },
            },
          },
          "name": [
            {
              "span": {
                "ec": 18,
                "el": 20,
                "sc": 11,
                "sl": 20,
              },
              "value": "RLCModel",
            },
          ],
          "span": {
            "ec": 18,
            "el": 20,
            "sc": 11,
            "sl": 20,
          },
        },
      ],
      "kind": "cdef",
      "metadata": null,
      "name": {
        "span": {
          "ec": 19,
          "el": 19,
          "sc": 11,
          "sl": 19,
        },
        "value": "RLCModel2",
      },
      "qualifier": null,
      "relations": [],
      "source": {
        "file": "systems",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 21,
        "sc": 1,
        "sl": 19,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "systems",
    "kind": "src",
    "mod": [],
  },
  "uses": [],
}
`;

exports[`Test Dyad Parser Parse systems 2`] = `
"component RLCModel
  resistor = ElectricalComponents.Resistor(R=100)
  capacitor = Capacitor(C=1m)
  inductor = Inductor(L=1)
  source::TwoPin() = VoltageSource(Vf=24)
  ground = Ground()
  path x::Real = 1.1
relations
  continuity(x, x)
  connect(source.p, inductor.p)
  connect(inductor.n, resistor.p, capacitor.p)
  connect(resistor.n, ground.g, capacitor.n, source.n)
end

component RLCModel2
  extends RLCModel(source=CurrentSource(i_final=1.5m))
end"
`;

exports[`Test Dyad Parser Parse type definitions 1`] = `
{
  "definitions": [
    {
      "base": {
        "kind": "qtype",
        "mods": {
          "units": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 29,
                "el": 4,
                "sc": 27,
                "sl": 4,
              },
              "type": "slit",
              "value": "V",
            },
            "final": false,
            "nested": null,
            "span": {
              "ec": 29,
              "el": 4,
              "sc": 21,
              "sl": 4,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 19,
              "el": 4,
              "sc": 16,
              "sl": 4,
            },
            "value": "Real",
          },
        ],
        "span": {
          "ec": 19,
          "el": 4,
          "sc": 16,
          "sl": 4,
        },
      },
      "doc_string": {
        "span": {
          "ec": 35,
          "el": 3,
          "sc": 1,
          "sl": 3,
        },
        "value": "This is a scalar type definition",
      },
      "kind": "scalar",
      "metadata": null,
      "name": {
        "span": {
          "ec": 12,
          "el": 4,
          "sc": 6,
          "sl": 4,
        },
        "value": "Voltage",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 4,
        "sc": 1,
        "sl": 3,
      },
    },
    {
      "base": {
        "kind": "qtype",
        "mods": {
          "units": {
            "expr": {
              "quoted": false,
              "span": {
                "ec": 35,
                "el": 6,
                "sc": 33,
                "sl": 6,
              },
              "type": "slit",
              "value": "A",
            },
            "final": true,
            "nested": null,
            "span": {
              "ec": 35,
              "el": 6,
              "sc": 21,
              "sl": 6,
            },
          },
        },
        "name": [
          {
            "span": {
              "ec": 19,
              "el": 6,
              "sc": 16,
              "sl": 6,
            },
            "value": "Real",
          },
        ],
        "span": {
          "ec": 19,
          "el": 6,
          "sc": 16,
          "sl": 6,
        },
      },
      "doc_string": null,
      "kind": "scalar",
      "metadata": null,
      "name": {
        "span": {
          "ec": 12,
          "el": 6,
          "sc": 6,
          "sl": 6,
        },
        "value": "Current",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 6,
        "sc": 1,
        "sl": 6,
      },
    },
    {
      "base": {
        "kind": "qtype",
        "mods": null,
        "name": [
          {
            "span": {
              "ec": 25,
              "el": 8,
              "sc": 15,
              "sl": 8,
            },
            "value": "SpecialType",
          },
        ],
        "span": {
          "ec": 25,
          "el": 8,
          "sc": 15,
          "sl": 8,
        },
      },
      "doc_string": null,
      "kind": "scalar",
      "metadata": null,
      "name": {
        "span": {
          "ec": 11,
          "el": 8,
          "sc": 6,
          "sl": 8,
        },
        "value": "MyType",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 8,
        "sc": 1,
        "sl": 8,
      },
    },
    {
      "base": {
        "kind": "qtype",
        "mods": null,
        "name": [
          {
            "span": {
              "ec": 25,
              "el": 10,
              "sc": 20,
              "sl": 10,
            },
            "value": "Native",
          },
        ],
        "span": {
          "ec": 25,
          "el": 10,
          "sc": 20,
          "sl": 10,
        },
      },
      "doc_string": null,
      "kind": "scalar",
      "metadata": null,
      "name": {
        "span": {
          "ec": 16,
          "el": 10,
          "sc": 6,
          "sl": 10,
        },
        "value": "MediumModel",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 10,
        "sc": 1,
        "sl": 10,
      },
    },
    {
      "doc_string": {
        "span": {
          "ec": 44,
          "el": 12,
          "sc": 1,
          "sl": 12,
        },
        "value": "This is the definition of a function type",
      },
      "keyword": {},
      "kind": "fun",
      "metadata": null,
      "name": {
        "span": {
          "ec": 21,
          "el": 13,
          "sc": 6,
          "sl": 13,
        },
        "value": "EnthalpyFunction",
      },
      "positional": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 39,
                "el": 13,
                "sc": 32,
                "sl": 13,
              },
              "value": "Pressure",
            },
          ],
          "span": {
            "ec": 39,
            "el": 13,
            "sc": 32,
            "sl": 13,
          },
        },
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 54,
                "el": 13,
                "sc": 44,
                "sl": 13,
              },
              "value": "Temperature",
            },
          ],
          "span": {
            "ec": 54,
            "el": 13,
            "sc": 44,
            "sl": 13,
          },
        },
      ],
      "returns": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 73,
                "el": 13,
                "sc": 58,
                "sl": 13,
              },
              "value": "SpecificEnthalpy",
            },
          ],
          "span": {
            "ec": 73,
            "el": 13,
            "sc": 58,
            "sl": 13,
          },
        },
      ],
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 13,
        "sc": 1,
        "sl": 12,
      },
    },
    {
      "doc_string": null,
      "keyword": {
        "name": {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 36,
                "el": 15,
                "sc": 31,
                "sl": 15,
              },
              "value": "String",
            },
          ],
          "span": {
            "ec": 36,
            "el": 15,
            "sc": 31,
            "sl": 15,
          },
        },
      },
      "kind": "fun",
      "metadata": null,
      "name": {
        "span": {
          "ec": 14,
          "el": 15,
          "sc": 6,
          "sl": 15,
        },
        "value": "JuliaFunc",
      },
      "positional": [],
      "returns": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 46,
                "el": 15,
                "sc": 40,
                "sl": 15,
              },
              "value": "Integer",
            },
          ],
          "span": {
            "ec": 46,
            "el": 15,
            "sc": 40,
            "sl": 15,
          },
        },
      ],
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 15,
        "sc": 1,
        "sl": 15,
      },
    },
    {
      "doc_string": null,
      "keyword": {},
      "kind": "fun",
      "metadata": null,
      "name": {
        "span": {
          "ec": 11,
          "el": 17,
          "sc": 6,
          "sl": 17,
        },
        "value": "Action",
      },
      "positional": [],
      "returns": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 29,
                "el": 17,
                "sc": 26,
                "sl": 17,
              },
              "value": "Real",
            },
          ],
          "span": {
            "ec": 29,
            "el": 17,
            "sc": 26,
            "sl": 17,
          },
        },
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 37,
                "el": 17,
                "sc": 34,
                "sl": 17,
              },
              "value": "Real",
            },
          ],
          "span": {
            "ec": 37,
            "el": 17,
            "sc": 34,
            "sl": 17,
          },
        },
      ],
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 17,
        "sc": 1,
        "sl": 17,
      },
    },
    {
      "doc_string": null,
      "keyword": {
        "b": {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 39,
                "el": 19,
                "sc": 36,
                "sl": 19,
              },
              "value": "Real",
            },
          ],
          "span": {
            "ec": 39,
            "el": 19,
            "sc": 36,
            "sl": 19,
          },
        },
      },
      "kind": "fun",
      "metadata": null,
      "name": {
        "span": {
          "ec": 16,
          "el": 19,
          "sc": 6,
          "sl": 19,
        },
        "value": "KitchenSink",
      },
      "positional": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 30,
                "el": 19,
                "sc": 27,
                "sl": 19,
              },
              "value": "Real",
            },
          ],
          "span": {
            "ec": 30,
            "el": 19,
            "sc": 27,
            "sl": 19,
          },
        },
      ],
      "returns": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 51,
                "el": 19,
                "sc": 46,
                "sl": 19,
              },
              "value": "String",
            },
          ],
          "span": {
            "ec": 51,
            "el": 19,
            "sc": 46,
            "sl": 19,
          },
        },
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 62,
                "el": 19,
                "sc": 56,
                "sl": 19,
              },
              "value": "Boolean",
            },
          ],
          "span": {
            "ec": 62,
            "el": 19,
            "sc": 56,
            "sl": 19,
          },
        },
      ],
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 19,
        "sc": 1,
        "sl": 19,
      },
    },
    {
      "doc_string": {
        "span": {
          "ec": 3,
          "el": 29,
          "sc": 1,
          "sl": 21,
        },
        "value": "This is the definition of a struct",
      },
      "fields": {
        "length": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 33,
              "el": 23,
              "sc": 3,
              "sl": 23,
            },
            "value": "The length of the stator arm",
          },
          "init": {
            "prefix": null,
            "repr": "10",
            "span": {
              "ec": 34,
              "el": 24,
              "sc": 33,
              "sl": 24,
            },
            "type": "ilit",
            "value": 10,
          },
          "kind": "field",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 24,
              "sc": 3,
              "sl": 23,
            },
            "value": "length",
          },
          "span": {
            "ec": 8,
            "el": 24,
            "sc": 3,
            "sl": 23,
          },
          "type": {
            "kind": "qtype",
            "mods": {
              "min": {
                "expr": {
                  "prefix": null,
                  "repr": "0",
                  "span": {
                    "ec": 28,
                    "el": 24,
                    "sc": 28,
                    "sl": 24,
                  },
                  "type": "ilit",
                  "value": 0,
                },
                "final": true,
                "nested": null,
                "span": {
                  "ec": 28,
                  "el": 24,
                  "sc": 18,
                  "sl": 24,
                },
              },
            },
            "name": [
              {
                "span": {
                  "ec": 16,
                  "el": 24,
                  "sc": 11,
                  "sl": 24,
                },
                "value": "Length",
              },
            ],
            "span": {
              "ec": 16,
              "el": 24,
              "sc": 11,
              "sl": 24,
            },
          },
        },
        "radius": {
          "cond": null,
          "dims": [],
          "doc_string": {
            "span": {
              "ec": 28,
              "el": 25,
              "sc": 3,
              "sl": 25,
            },
            "value": "The radius of the rotor",
          },
          "init": null,
          "kind": "field",
          "metadata": {
            "kind": "meta",
            "span": {
              "ec": 76,
              "el": 26,
              "sc": 20,
              "sl": 26,
            },
            "value": {
              "Dyad": {
                "dialog": "Mechanical",
                "group": "Geometry",
              },
            },
          },
          "name": {
            "span": {
              "ec": 8,
              "el": 26,
              "sc": 3,
              "sl": 25,
            },
            "value": "radius",
          },
          "span": {
            "ec": 8,
            "el": 26,
            "sc": 3,
            "sl": 25,
          },
          "type": {
            "kind": "qtype",
            "mods": {},
            "name": [
              {
                "span": {
                  "ec": 16,
                  "el": 26,
                  "sc": 11,
                  "sl": 26,
                },
                "value": "Radius",
              },
            ],
            "span": {
              "ec": 16,
              "el": 26,
              "sc": 11,
              "sl": 26,
            },
          },
        },
        "x": {
          "cond": null,
          "dims": [
            {
              "prefix": null,
              "repr": "3",
              "span": {
                "ec": 15,
                "el": 28,
                "sc": 15,
                "sl": 28,
              },
              "type": "ilit",
              "value": 3,
            },
          ],
          "doc_string": {
            "span": {
              "ec": 22,
              "el": 27,
              "sc": 3,
              "sl": 27,
            },
            "value": "Position in space",
          },
          "init": null,
          "kind": "field",
          "metadata": null,
          "name": {
            "span": {
              "ec": 3,
              "el": 28,
              "sc": 3,
              "sl": 27,
            },
            "value": "x",
          },
          "span": {
            "ec": 3,
            "el": 28,
            "sc": 3,
            "sl": 27,
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 13,
                  "el": 28,
                  "sc": 6,
                  "sl": 28,
                },
                "value": "Position",
              },
            ],
            "span": {
              "ec": 13,
              "el": 28,
              "sc": 6,
              "sl": 28,
            },
          },
        },
      },
      "kind": "struct",
      "metadata": null,
      "name": {
        "span": {
          "ec": 15,
          "el": 22,
          "sc": 8,
          "sl": 22,
        },
        "value": "Geometry",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 3,
        "el": 29,
        "sc": 1,
        "sl": 21,
      },
    },
    {
      "cases": {
        "Blue": {
          "doc_string": null,
          "fields": {},
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 35,
              "sc": 5,
              "sl": 35,
            },
            "value": "Blue",
          },
          "source": null,
          "span": null,
        },
        "Green": {
          "doc_string": null,
          "fields": {},
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 9,
              "el": 34,
              "sc": 5,
              "sl": 34,
            },
            "value": "Green",
          },
          "source": null,
          "span": null,
        },
        "Red": {
          "doc_string": null,
          "fields": {},
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 7,
              "el": 33,
              "sc": 5,
              "sl": 33,
            },
            "value": "Red",
          },
          "source": null,
          "span": null,
        },
      },
      "doc_string": {
        "span": {
          "ec": 15,
          "el": 32,
          "sc": 1,
          "sl": 31,
        },
        "value": "This is the definition of an enum",
      },
      "kind": "enum",
      "metadata": null,
      "name": {
        "span": {
          "ec": 15,
          "el": 32,
          "sc": 6,
          "sl": 32,
        },
        "value": "LightColor",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 15,
        "el": 32,
        "sc": 1,
        "sl": 31,
      },
    },
    {
      "cases": {
        "Equilibrium": {
          "doc_string": null,
          "fields": {},
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 15,
              "el": 40,
              "sc": 5,
              "sl": 40,
            },
            "value": "Equilibrium",
          },
          "source": null,
          "span": null,
        },
        "FixedPosition": {
          "doc_string": null,
          "fields": {
            "s0": {
              "cond": null,
              "dims": [],
              "doc_string": null,
              "init": null,
              "kind": "field",
              "metadata": null,
              "name": {
                "span": {
                  "ec": 20,
                  "el": 38,
                  "sc": 19,
                  "sl": 38,
                },
                "value": "s0",
              },
              "span": {
                "ec": 20,
                "el": 38,
                "sc": 19,
                "sl": 38,
              },
              "type": {
                "kind": "qtype",
                "mods": null,
                "name": [
                  {
                    "span": {
                      "ec": 30,
                      "el": 38,
                      "sc": 23,
                      "sl": 38,
                    },
                    "value": "Position",
                  },
                ],
                "span": {
                  "ec": 30,
                  "el": 38,
                  "sc": 23,
                  "sl": 38,
                },
              },
            },
          },
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 17,
              "el": 38,
              "sc": 5,
              "sl": 38,
            },
            "value": "FixedPosition",
          },
          "source": null,
          "span": null,
        },
        "FixedSpeedAndPosition": {
          "doc_string": null,
          "fields": {
            "s0": {
              "cond": null,
              "dims": [],
              "doc_string": null,
              "init": null,
              "kind": "field",
              "metadata": null,
              "name": {
                "span": {
                  "ec": 28,
                  "el": 39,
                  "sc": 27,
                  "sl": 39,
                },
                "value": "s0",
              },
              "span": {
                "ec": 28,
                "el": 39,
                "sc": 27,
                "sl": 39,
              },
              "type": {
                "kind": "qtype",
                "mods": null,
                "name": [
                  {
                    "span": {
                      "ec": 38,
                      "el": 39,
                      "sc": 31,
                      "sl": 39,
                    },
                    "value": "Position",
                  },
                ],
                "span": {
                  "ec": 38,
                  "el": 39,
                  "sc": 31,
                  "sl": 39,
                },
              },
            },
            "v0": {
              "cond": null,
              "dims": [],
              "doc_string": null,
              "init": null,
              "kind": "field",
              "metadata": null,
              "name": {
                "span": {
                  "ec": 42,
                  "el": 39,
                  "sc": 41,
                  "sl": 39,
                },
                "value": "v0",
              },
              "span": {
                "ec": 42,
                "el": 39,
                "sc": 41,
                "sl": 39,
              },
              "type": {
                "kind": "qtype",
                "mods": null,
                "name": [
                  {
                    "span": {
                      "ec": 52,
                      "el": 39,
                      "sc": 45,
                      "sl": 39,
                    },
                    "value": "Velocity",
                  },
                ],
                "span": {
                  "ec": 52,
                  "el": 39,
                  "sc": 45,
                  "sl": 39,
                },
              },
            },
          },
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 25,
              "el": 39,
              "sc": 5,
              "sl": 39,
            },
            "value": "FixedSpeedAndPosition",
          },
          "source": null,
          "span": null,
        },
        "None": {
          "doc_string": null,
          "fields": {},
          "kind": "struct",
          "metadata": null,
          "name": {
            "span": {
              "ec": 8,
              "el": 41,
              "sc": 5,
              "sl": 41,
            },
            "value": "None",
          },
          "source": null,
          "span": null,
        },
      },
      "doc_string": null,
      "kind": "enum",
      "metadata": null,
      "name": {
        "span": {
          "ec": 26,
          "el": 37,
          "sc": 6,
          "sl": 37,
        },
        "value": "InitializationOptions",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 26,
        "el": 37,
        "sc": 6,
        "sl": 37,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "typedef",
    "kind": "src",
    "mod": [],
  },
  "uses": [
    {
      "kind": "using",
      "module": {
        "span": {
          "ec": 18,
          "el": 1,
          "sc": 7,
          "sl": 1,
        },
        "value": "OtherLibrary",
      },
      "source": {
        "file": "typedef",
        "kind": "src",
        "mod": [],
      },
      "symbols": [
        {
          "symbol": {
            "span": {
              "ec": 31,
              "el": 1,
              "sc": 21,
              "sl": 1,
            },
            "value": "SpecialType",
          },
          "type": null,
        },
      ],
    },
  ],
}
`;

exports[`Test Dyad Parser Parse type definitions 2`] = `
"using OtherLibrary: SpecialType

type Voltage = Real(units="V")

type Current = Real(final units="A")

type MyType = SpecialType

type MediumModel = Native

type EnthalpyFunction = func(::Pressure, ::Temperature)::SpecificEnthalpy

type JuliaFunc = func(; name::String)::Integer

type Action = func()::(::Real, ::Real)

type KitchenSink = func(::Real; b::Real)::(::String, ::Boolean)

struct Geometry
  length::Length(final min=0) = 10
  radius::Radius()
  x::Position[3]
end

enum LightColor =
  | Red
  | Green
  | Blue

enum InitializationOptions =
  | FixedPosition(s0::Position)
  | FixedSpeedAndPosition(s0::Position, v0::Velocity)
  | Equilibrium
  | None"
`;

exports[`Test Dyad Parser Parse using statements 1`] = `
{
  "definitions": [
    {
      "doc_string": null,
      "keyword": {},
      "kind": "fun",
      "metadata": null,
      "name": {
        "span": {
          "ec": 20,
          "el": 5,
          "sc": 6,
          "sl": 5,
        },
        "value": "DensityFunction",
      },
      "positional": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 41,
                "el": 5,
                "sc": 31,
                "sl": 5,
              },
              "value": "MediumModel",
            },
          ],
          "span": {
            "ec": 41,
            "el": 5,
            "sc": 31,
            "sl": 5,
          },
        },
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 53,
                "el": 5,
                "sc": 46,
                "sl": 5,
              },
              "value": "Pressure",
            },
          ],
          "span": {
            "ec": 53,
            "el": 5,
            "sc": 46,
            "sl": 5,
          },
        },
      ],
      "returns": [
        {
          "kind": "qtype",
          "mods": null,
          "name": [
            {
              "span": {
                "ec": 63,
                "el": 5,
                "sc": 57,
                "sl": 5,
              },
              "value": "Density",
            },
          ],
          "span": {
            "ec": 63,
            "el": 5,
            "sc": 57,
            "sl": 5,
          },
        },
      ],
      "source": {
        "file": "using",
        "kind": "src",
        "mod": [],
      },
      "span": {
        "ec": 4,
        "el": 5,
        "sc": 1,
        "sl": 5,
      },
    },
  ],
  "kind": "file",
  "provider": "foo",
  "source": {
    "file": "using",
    "kind": "src",
    "mod": [],
  },
  "uses": [
    {
      "kind": "using",
      "module": {
        "span": {
          "ec": 16,
          "el": 1,
          "sc": 7,
          "sl": 1,
        },
        "value": "Electrical",
      },
      "source": {
        "file": "using",
        "kind": "src",
        "mod": [],
      },
      "symbols": [
        {
          "symbol": {
            "span": {
              "ec": 25,
              "el": 1,
              "sc": 19,
              "sl": 1,
            },
            "value": "Voltage",
          },
          "type": null,
        },
      ],
    },
    {
      "kind": "using",
      "module": {
        "span": {
          "ec": 16,
          "el": 2,
          "sc": 7,
          "sl": 2,
        },
        "value": "Mechanical",
      },
      "source": {
        "file": "using",
        "kind": "src",
        "mod": [],
      },
      "symbols": [
        {
          "symbol": {
            "span": {
              "ec": 24,
              "el": 2,
              "sc": 19,
              "sl": 2,
            },
            "value": "Flange",
          },
          "type": null,
        },
        {
          "symbol": {
            "span": {
              "ec": 32,
              "el": 2,
              "sc": 27,
              "sl": 2,
            },
            "value": "Spring",
          },
          "type": null,
        },
      ],
    },
    {
      "kind": "using",
      "module": {
        "span": {
          "ec": 7,
          "el": 3,
          "sc": 7,
          "sl": 3,
        },
        "value": ".",
      },
      "source": {
        "file": "using",
        "kind": "src",
        "mod": [],
      },
      "symbols": [
        {
          "symbol": {
            "span": {
              "ec": 16,
              "el": 3,
              "sc": 10,
              "sl": 3,
            },
            "value": "density",
          },
          "type": {
            "kind": "qtype",
            "mods": null,
            "name": [
              {
                "span": {
                  "ec": 33,
                  "el": 3,
                  "sc": 19,
                  "sl": 3,
                },
                "value": "DensityFunction",
              },
            ],
            "span": {
              "ec": 33,
              "el": 3,
              "sc": 19,
              "sl": 3,
            },
          },
        },
      ],
    },
  ],
}
`;

exports[`Test Dyad Parser Parse using statements 2`] = `
"using Electrical: Voltage
using Mechanical: Flange, Spring
using .: density::DensityFunction

type DensityFunction = func(::MediumModel, ::Pressure)::Density"
`;
